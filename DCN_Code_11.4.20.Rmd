---
title: "Restructuring of amygdala subregion apportion across adolescence"
output: html_markdown
Created by: Megan Herting and Claire Campbell
Purpose: Exploratory analysis of R03 data to amygdala subregion segementation data created by Adam Mezher using the CIT168 atlas (Tyszka and Pauli, 2016). Using output file called complete_data_4.25.18_zBMI.csv generated by Read In SPPSS File.rmd located in project file.
---


```{r}
#Clear existing data and graphics
rm(list=ls())
graphics.off()
```

```{r}
##Install and load necessary Packages
#install.packages('DataExplorer') #Only run if not installed
library(tidyverse)
library(mgcv)
library(data.table)
library(gridExtra)
library(grid)
library(lattice)
library(knitr)
library(htmlTable)
library(ICC)
library(psych)
library(doBy)
library(lmtest)
library(corrplot)
library(GGally)
```


```{r Import Data}
##Import data
#Now doesn't contain E0065 because brain mask not accurate
mydata_pre = read.csv('complete_4.25.18_BMIz.csv')

mydata_pre$sex_orderedfactor <- as.ordered(mydata_pre$sex)

mydata_pre$pds_orderedfactor <- as.ordered(mydata_pre$a_pds_crockett_stage)
contrasts(mydata_pre$pds_orderedfactor) <-'contr.treatment'

#Remove values without bmi_z values
mydata_pre <- subset(mydata_pre,(!is.na(mydata_pre$bmi_z)))

#write_csv(mydata_pre, 'mydata_bmiz.csv')

#Read in data with SES variable
more_data <- read.csv('All Visit Master_CC_edit.csv')
ses <- subset(more_data, select=c("a_Scan_ID","S_24g_1"))

#Merge SES data into mydata
mydata_ses <- merge(mydata_pre,ses, by.x="scan_id", by.y="a_Scan_ID")

#Read in CNR data
cnr <- read.csv('CNR_Both_Hemispheres.csv')
cnr$X <- NULL

#Merge CNR into mydata
mydata_cnr <- merge(mydata_ses,cnr,by.x="subject",by.y="Subject")

mydata <- subset(mydata_cnr, CNR_Left>1 & CNR_Right>1)

####All exports and ggsave functions are preceeded by a '#'; if would like to export again, please delete the '#'
```

```{r}
# Coefficient of variation function
mean_cov <- function(x) { c(Mean = mean(x), CoV = sd(x)/mean(x) * 100.0) }
#mean_sd nowhere else in code
mean_sd <- function(x) { c(Mean = mean(x), SD = sd(x)) }
```

```{r}
##Create mean/sd for demographics table

##Data for just females
mydata.f <- subset(mydata, sex_orderedfactor=="f")

##Data for just males
mydata.m <- subset(mydata, sex_orderedfactor=="m")

#Create a variable list which we want in correlation Table 1
listVar <- c("age", "bmi_z", "ICV", "a_pds_comp_1", "S_24g_1")

#Create correlation dataset for ALL
table_var <- mydata[, c("age", "bmi_z", "ICV","a_pds_comp_1", "S_24g_1")]
#For Females
table_var.f <- mydata.f[, c("age", "bmi_z", "ICV","a_pds_comp_1", "S_24g_1")]
#For Males
table_var.m <- mydata.m[, c("age", "bmi_z", "ICV","a_pds_comp_1", "S_24g_1")]


#N, mean, SD
#ALL
dem_all <- as.data.frame(sapply(table_var, function(cl) list(means_all=mean(cl,na.rm=TRUE), sds_all=sd(cl,na.rm=TRUE), N_all=length(cl[!is.na(cl)]))))
as.data.frame(dem_all)
#Female
dem_f <- as.data.frame(sapply(table_var.f, function(cl) list(means_f=mean(cl,na.rm=TRUE), sds_f=sd(cl,na.rm=TRUE), N_f=length(cl[!is.na(cl)]))))
#Male
dem_m <- as.data.frame(sapply(table_var.m, function(cl) list(means_m=mean(cl,na.rm=TRUE), sds_m=sd(cl,na.rm=TRUE), N_m=length(cl[!is.na(cl)]))))
#Combine all tables into one
dem_table <- cbind(dem_all, dem_f, dem_m)
#Export table
#lapply(dem_table, function(x) write.table( data.frame(x), 'Demographics_12.17.19.csv'  , append= T, sep=',' ))


#Linear models for Table 1a to look at difference between sexes
age_sex <- lm(age~sex_orderedfactor,data=mydata)
bmiz_sex <- lm(bmi_z~sex_orderedfactor,data=mydata)
ICV_sex <- lm(ICV~sex_orderedfactor,data=mydata)
pds_sex <- lm(a_pds_comp_1~sex_orderedfactor,data=mydata)
ses_sex <- lm(S_24g_1~sex_orderedfactor,data=mydata)
#summaries
# summary(age_sex)
# summary(bmiz_sex)
# summary(ICV_sex)
# summary(pds_sex)
# summary(ses_sex)

#Linear models for Table 1b
icv_age <- lm(ICV~sex_orderedfactor*age, data=mydata)
bmi_age <- lm(bmi_z~sex_orderedfactor*age, data=mydata)
ses_age <- lm(S_24g_1~sex_orderedfactor*age, data=mydata)
icv_pds <- lm(ICV~sex_orderedfactor*a_pds_comp_1, data=mydata)
bmi_pds <- lm(bmi_z~sex_orderedfactor*a_pds_comp_1, data=mydata)
ses_pds <- lm(S_24g_1~sex_orderedfactor*a_pds_comp_1, data=mydata)
#summaries
# summary(icv_age)
# summary(bmi_age)
# summary(ses_age)
# summary(icv_pds)
# summary(bmi_pds)
# summary(ses_pds)

#Plot relationship between ICV and age, ICV and pds
# ggplot(mydata.m,aes(age, ICV)) + geom_smooth() + geom_point()
# ggplot(mydata.f,aes(age, ICV)) + geom_smooth() + geom_point()
# ggplot(mydata, aes(age,ICV)) + geom_smooth() + geom_point()
# ggplot(mydata,aes(ICV,bmi_z)) + geom_smooth()
# ggplot(mydata,aes(bmi_z,ICV)) + geom_smooth()

# #Find out numbers for each pubertal stage for all subjects and each sex
# #Create dataset with subjects without pds crockett removes
# mydata_pds <- subset(mydata,(!is.na(mydata$a_pds_crockett_stage)))
# #Count how pds in total and then per stage
# count(mydata_pds, a_pds_crockett_stage)
# #Make datasets for each sex
# mydata_pds_f=subset(mydata_pds, sex_orderedfactor=="f")
# mydata_pds_m=subset(mydata_pds, sex_orderedfactor=="m")
# #Count for each dataset
# count(mydata_pds_f, a_pds_crockett_stage)
# count(mydata_pds_m, a_pds_crockett_stage)
# 
# #Plot a_pds_comp_1 to see if evenly distributed
# hist(mydata_pds_f$a_pds_comp_1)
# pds_females <- ggplot(mydata.f,aes(a_pds_comp_1))+geom_density()+ggtitle("Females")
# pds_males <- ggplot(mydata.m,aes(a_pds_comp_1))+geom_density()+ggtitle("Males")
# # ggsave(filename = "PDS_Dist_Females.png",pds_females, device='png')
# # ggsave(filename = "PDS_Dist_Males.png",pds_males, device='png')
# 
# pds_comp_plot <- grid.arrange(pds_females, pds_males, ncol=2)    
# 
# #Check if N of groups different
# #First combine groups into two categories
# #Early = Pre-Pubertal, Early Pubertal, Mid-Pubertal
# #Late = Late Pubertal, Post Pubertal
# mydata_pds$crockett_twocat <- mydata_pds$a_pds_crockett_stage
# mydata_pds$crockett_twocat <- as.character(mydata_pds$crockett_twocat)
# mydata_pds$crockett_twocat[mydata_pds$crockett_twocat=="Pre-Pubertal"] <- "Early"
# mydata_pds$crockett_twocat[mydata_pds$crockett_twocat=="Early Pubertal"] <- "Early"
# mydata_pds$crockett_twocat[mydata_pds$crockett_twocat=="Mid-Pubertal"] <- "Early"
# mydata_pds$crockett_twocat[mydata_pds$crockett_twocat=="Late Pubertal"] <- "Late"
# mydata_pds$crockett_twocat[mydata_pds$crockett_twocat=="Post Pubertal"] <- "Late"
# 
# #Check whether N difference is significant between sexes
# data.xtabs <- xtabs(~sex_orderedfactor+crockett_twocat,mydata_pds)


##Distribution of age by sex for our sample - histogram count
g <- ggplot(mydata, aes(age))
g+geom_histogram(aes(fill=sex),binwidth=1)
density_age <- g+geom_density(aes(fill=sex), alpha=0.6) + labs(title="Density Plot of Age by Sex",x="Age (years)",fill="Sex") + scale_fill_manual(values=c("coral1","blue"),labels=c("Female","Male")) + theme(legend.position = c(0.09, 0.885),plot.title=element_text(hjust = 0.5),legend.background = element_rect(fill="transparent",colour="transparent"))

#ggsave(filename = "RevisedFigures_Revisions/figS1_8.31.20.png",density_age,width = 12, height = 7, dpi = 300, units = "in", device='png')
```


```{r}
##Compare freesurfer & total probability 

##Gather data into nested types
data_total_vol<-reshape(mydata, varying=list(c("FS_Amygdala_Right","FS_Amygdala_Left"), c("ProbVol_TotalAmygdala_Right","ProbVol_TotalAmygdala_Left")),v.names=c("FS", "CIT168"), idvar="subject", timevar="hemisphere", times=c("right", "left"),direction="long")

data_total_vol_col<-reshape(data_total_vol, varying=list(c("FS","CIT168")), v.names="volume", idvar=c("subject", "hemisphere"),timevar="method", times=c("FS", "CIT168"), direction="long")

#Figure 1a
corplot=ggplot(data_total_vol, aes (x=FS, y=CIT168))+ geom_point(aes(color=sex))+facet_grid(.~hemisphere)+theme_bw()+theme(text = element_text(size=20))
corplot

#ggsave(filename = "fig1_icc.png",corplot,width = 12, height = 7, dpi = 300, units = "in", device='png')

mydata$FS_Amygdala_Average<- (mydata$FS_Amygdala_Right + mydata$FS_Amygdala_Left)/2
mydata$CIT168_Amygdala_Average<- (mydata$ProbVol_TotalAmygdala_Right + mydata$ProbVol_TotalAmygdala_Left)/2

#Histograms
# hist(mydata$FS_Amygdala_Right, col=rgb(1,0,0,0.5),xlim=c(1000,2700), ylim=c(0,100))
# hist(mydata$ProbVol_TotalAmygdala_Right, col=rgb(0,0,1,0.5), add=T)
# 
# hist(mydata$FS_Amygdala_Left, col=rgb(1,0,0,0.5),xlim=c(1000,2700), ylim=c(0,100))
# hist(mydata$ProbVol_TotalAmygdala_Left, col=rgb(0,0,1,0.5), add=T)
# 
# hist(mydata$FS_Amygdala_Average, col=rgb(1,0,0,0.5),xlim=c(1000,2700), ylim=c(0,100))
# hist(mydata$CIT168_Amygdala_Average, col=rgb(0,0,1,0.5), add=T)

# Report descriptive statistics for Total Amygdala volumes
Totalvols <- summaryBy(volume ~ sex_orderedfactor * hemisphere *method,  data=data_total_vol_col, FUN = mean_cov)
#print(Totalvols, digits=3)
#write.table(Totalvols, "TotalVolumes.csv", sep=",", row.names=FALSE)

# min(mydata$ProbVol_TotalAmygdala_Left)
# max(mydata$ProbVol_TotalAmygdala_Left)
# min(mydata$ProbVol_TotalAmygdala_Right)
# max(mydata$ProbVol_TotalAmygdala_Right)
# 
# ###ICC for right hemisphere
# ICC(data_total_vol[1:422,123:124])
# 
# 
# ###ICC for left hemisphere
# ICC(data_total_vol[423:844,123:124])


##Plot distributions for our own knowledge
#p <- ggplot(data_total_vol_col, aes(method, volume))
#p + geom_violin(aes(fill=factor(hemisphere)))+facet_grid(.~sex)+ylab("Volume")+ theme_bw()+scale_fill_manual(values=c("Dark Gray", "Light Gray"), name="Hemisphere", labels=c("Left", "Right"))
```

```{r}
##Gather data into nested types and plot Violin on same data plot (Absolute) - plotted later in code in chunk "Reshape and Violin Plots"

data_long<-reshape(mydata, varying=list(c("ProbVol_LA_Right","ProbVol_LA_Left"),c("ProbVol_BLDI_Right","ProbVol_BLDI_Left"),c("ProbVol_BLVPL_Right","ProbVol_BLVPL_Left"),c("ProbVol_BM_Right", "ProbVol_BM_Left"), c("ProbVol_CMN_Right","ProbVol_CMN_Left"), c("ProbVol_CEN_Right", "ProbVol_CEN_Left"),c("ProbVol_AAA_Right","ProbVol_AAA_Left"),c("ProbVol_ATA_Right","ProbVol_ATA_Left"), c("ProbVol_ASTA_Right","ProbVol_ASTA_Left"),c("CNR_Right","CNR_Left")),v.names=c("ProbVol_LA","ProbVol_BLDI","ProbVol_BLVPL","ProbVol_BM","ProbVol_CMN", "ProbVol_CEN","ProbVol_AAA", "ProbVol_ATA", "ProbVol_ASTA","CNR"), idvar="subject", timevar="hemisphere", times=c("right", "left"),direction="long")

data_long_col<-reshape(data_long, varying=list(c("ProbVol_LA","ProbVol_BLDI","ProbVol_BLVPL","ProbVol_BM", "ProbVol_CMN","ProbVol_CEN","ProbVol_AAA", "ProbVol_ATA", "ProbVol_ASTA")), idvar=c("subject", "hemisphere"), v.names="volume", timevar="subregion", times=c("LA","BLDI","BLVPL","BM", "CMN", "CEN","AAA","ATA","ASTA"), direction="long")

data_long_col$subregion_orderedfactor<-  factor(data_long_col$subregion,  levels = c("LA", "BLDI", "BLVPL", "BM", "CMN", "CEN", "AAA", "ATA", "ASTA"))
levels(data_long_col$sex_orderedfactor) <- c("Female", "Male")

```

```{r}
##Create relative amygdala volumes scaled by total amygdala 
keep_norm <- c("subject","sex","age","bmi_z", "bio_bmi_cat", "a_pds_comp_1", "a_pds_crockett_stage","S_24g_1","ICV","ProbVol_TotalAmygdala_Right","ProbVol_TotalAmygdala_Left","ProbVol_BasolateralNucleus_Right","ProbVol_BasolateralNucleus_Left","ProbVol_CorticoMedialNucleus_Right","ProbVol_CorticoMedialNucleus_Left","ProbVol_CentralNucleus_Right","ProbVol_CentralNucleus_Left","ProbVol_LA_Right","ProbVol_BLDI_Right","ProbVol_BM_Right","ProbVol_CEN_Right","ProbVol_CMN_Right","ProbVol_BLVPL_Right","ProbVol_ATA_Right","ProbVol_ASTA_Right","ProbVol_AAA_Right","ProbVol_OTHER_Right","ProbVol_LA_Left","ProbVol_BLDI_Left","ProbVol_BM_Left","ProbVol_CEN_Left","ProbVol_CMN_Left","ProbVol_BLVPL_Left","ProbVol_ATA_Left","ProbVol_ASTA_Left","ProbVol_AAA_Left","ProbVol_OTHER_Left")
norm_mydata <- mydata[keep_norm]

#Normalize each region to the total volume of each side and add to norm_mydata dataset
#Right side
norm_mydata$Norm_ProbVol_BLDI_Right <- (mydata$ProbVol_BLDI_Right / mydata$ProbVol_TotalAmygdala_Right)
norm_mydata$Norm_ProbVol_BLVPL_Right <- (mydata$ProbVol_BLVPL_Right / mydata$ProbVol_TotalAmygdala_Right)
norm_mydata$Norm_ProbVol_BM_Right <- (mydata$ProbVol_BM_Right / mydata$ProbVol_TotalAmygdala_Right)
norm_mydata$Norm_ProbVol_CEN_Right <- (mydata$ProbVol_CEN_Right / mydata$ProbVol_TotalAmygdala_Right)
norm_mydata$Norm_ProbVol_CMN_Right <- (mydata$ProbVol_CMN_Right / mydata$ProbVol_TotalAmygdala_Right)
norm_mydata$Norm_ProbVol_LA_Right <- (mydata$ProbVol_LA_Right / mydata$ProbVol_TotalAmygdala_Right)
norm_mydata$Norm_ProbVol_AAA_Right <- (mydata$ProbVol_AAA_Right / mydata$ProbVol_TotalAmygdala_Right)
norm_mydata$Norm_ProbVol_ASTA_Right <- (mydata$ProbVol_ASTA_Right / mydata$ProbVol_TotalAmygdala_Right)
norm_mydata$Norm_ProbVol_ATA_Right <- (mydata$ProbVol_ATA_Right / mydata$ProbVol_TotalAmygdala_Right)
norm_mydata$Norm_ProbVol_OTHER_Right <- (mydata$ProbVol_OTHER_Right / mydata$ProbVol_TotalAmygdala_Right)

#Left side
norm_mydata$Norm_ProbVol_BLDI_Left <- (mydata$ProbVol_BLDI_Left / mydata$ProbVol_TotalAmygdala_Left)
norm_mydata$Norm_ProbVol_BLVPL_Left <- (mydata$ProbVol_BLVPL_Left / mydata$ProbVol_TotalAmygdala_Left)
norm_mydata$Norm_ProbVol_BM_Left <- (mydata$ProbVol_BM_Left / mydata$ProbVol_TotalAmygdala_Left)
norm_mydata$Norm_ProbVol_CEN_Left <- (mydata$ProbVol_CEN_Left / mydata$ProbVol_TotalAmygdala_Left)
norm_mydata$Norm_ProbVol_CMN_Left <- (mydata$ProbVol_CMN_Left / mydata$ProbVol_TotalAmygdala_Left)
norm_mydata$Norm_ProbVol_LA_Left <- (mydata$ProbVol_LA_Left / mydata$ProbVol_TotalAmygdala_Left)
norm_mydata$Norm_ProbVol_AAA_Left <- (mydata$ProbVol_AAA_Left / mydata$ProbVol_TotalAmygdala_Left)
norm_mydata$Norm_ProbVol_ASTA_Left <- (mydata$ProbVol_ASTA_Left / mydata$ProbVol_TotalAmygdala_Left)
norm_mydata$Norm_ProbVol_ATA_Left <- (mydata$ProbVol_ATA_Left / mydata$ProbVol_TotalAmygdala_Left)
norm_mydata$Norm_ProbVol_OTHER_Left <- (mydata$ProbVol_OTHER_Left / mydata$ProbVol_TotalAmygdala_Left)

#Create sex ordered factor
norm_mydata$sex_orderedfactor <- as.ordered(norm_mydata$sex)

##Data for just females
norm_mydata.f <- subset(norm_mydata, sex_orderedfactor=="f")

##Data for just males
norm_mydata.m <- subset(norm_mydata, sex_orderedfactor=="m")

##Correlation with each RVF and ICV
ICVcorr_f <- cor(norm_mydata.f[,c("ICV","Norm_ProbVol_LA_Right","Norm_ProbVol_LA_Left","Norm_ProbVol_BLDI_Right","Norm_ProbVol_BLDI_Left","Norm_ProbVol_BLVPL_Right","Norm_ProbVol_BLVPL_Left","Norm_ProbVol_BM_Right", "Norm_ProbVol_BM_Left","Norm_ProbVol_CMN_Right","Norm_ProbVol_CMN_Left","Norm_ProbVol_CEN_Right", "Norm_ProbVol_CEN_Left","Norm_ProbVol_AAA_Right","Norm_ProbVol_AAA_Left","Norm_ProbVol_ATA_Right","Norm_ProbVol_ATA_Left","Norm_ProbVol_ASTA_Right","Norm_ProbVol_ASTA_Left")])
ICVcorr_m <- cor(norm_mydata.m[,c("ICV","Norm_ProbVol_LA_Right","Norm_ProbVol_LA_Left","Norm_ProbVol_BLDI_Right","Norm_ProbVol_BLDI_Left","Norm_ProbVol_BLVPL_Right","Norm_ProbVol_BLVPL_Left","Norm_ProbVol_BM_Right", "Norm_ProbVol_BM_Left","Norm_ProbVol_CMN_Right","Norm_ProbVol_CMN_Left","Norm_ProbVol_CEN_Right", "Norm_ProbVol_CEN_Left","Norm_ProbVol_AAA_Right","Norm_ProbVol_AAA_Left","Norm_ProbVol_ATA_Right","Norm_ProbVol_ATA_Left","Norm_ProbVol_ASTA_Right","Norm_ProbVol_ASTA_Left")])
#write.table(ICVcorr_f, "Normed Correlation with ICV - females.csv", sep=",", row.names=FALSE)
#write.table(ICVcorr_m, "Normed Correlation with ICV - males.csv", sep=",", row.names=FALSE)

##Correlation matrix between hemispheres
##Correlation with RVF (normed volume)
##ALL
corr_rvf <- cor(norm_mydata[,c("Norm_ProbVol_LA_Right","Norm_ProbVol_BLDI_Right","Norm_ProbVol_BLVPL_Right","Norm_ProbVol_BM_Right", "Norm_ProbVol_CMN_Right","Norm_ProbVol_CEN_Right", "Norm_ProbVol_AAA_Right","Norm_ProbVol_ATA_Right","Norm_ProbVol_ASTA_Right")],norm_mydata[,c("Norm_ProbVol_LA_Left","Norm_ProbVol_BLDI_Left","Norm_ProbVol_BLVPL_Left","Norm_ProbVol_BM_Left","Norm_ProbVol_CMN_Left","Norm_ProbVol_CEN_Left","Norm_ProbVol_AAA_Left","Norm_ProbVol_ATA_Left","Norm_ProbVol_ASTA_Left")])
rownames(corr_rvf) <- c("LA_Right","BLDI_Right","BLVPL_Right","BM_Right", "CMN_Right","CEN_Right", "AAA_Right","ATA_Right","ASTA_Right")
colnames(corr_rvf) <- c("LA_Left","BLDI_Left","BLVPL_Left","BM_Left", "CMN_Left","CEN_Left", "AAA_Left","ATA_Left","ASTA_Left")
corrplot(corr_rvf,method="number")

##Female
corr_rvf.f <- cor(norm_mydata.f[,c("Norm_ProbVol_LA_Right","Norm_ProbVol_BLDI_Right","Norm_ProbVol_BLVPL_Right","Norm_ProbVol_BM_Right", "Norm_ProbVol_CMN_Right","Norm_ProbVol_CEN_Right", "Norm_ProbVol_AAA_Right","Norm_ProbVol_ATA_Right","Norm_ProbVol_ASTA_Right")],norm_mydata.f[,c("Norm_ProbVol_LA_Left","Norm_ProbVol_BLDI_Left","Norm_ProbVol_BLVPL_Left","Norm_ProbVol_BM_Left","Norm_ProbVol_CMN_Left","Norm_ProbVol_CEN_Left","Norm_ProbVol_AAA_Left","Norm_ProbVol_ATA_Left","Norm_ProbVol_ASTA_Left")])
rownames(corr_rvf.f) <- c("LA_Right","BLDI_Right","BLVPL_Right","BM_Right", "CMN_Right","CEN_Right", "AAA_Right","ATA_Right","ASTA_Right")
colnames(corr_rvf.f) <- c("LA_Left","BLDI_Left","BLVPL_Left","BM_Left", "CMN_Left","CEN_Left", "AAA_Left","ATA_Left","ASTA_Left")
corrplot(corr_rvf.f,method="number")
##Male
corr_rvf.m <- cor(norm_mydata.m[,c("Norm_ProbVol_LA_Right","Norm_ProbVol_BLDI_Right","Norm_ProbVol_BLVPL_Right","Norm_ProbVol_BM_Right", "Norm_ProbVol_CMN_Right","Norm_ProbVol_CEN_Right", "Norm_ProbVol_AAA_Right","Norm_ProbVol_ATA_Right","Norm_ProbVol_ASTA_Right")],norm_mydata.m[,c("Norm_ProbVol_LA_Left","Norm_ProbVol_BLDI_Left","Norm_ProbVol_BLVPL_Left","Norm_ProbVol_BM_Left","Norm_ProbVol_CMN_Left","Norm_ProbVol_CEN_Left","Norm_ProbVol_AAA_Left","Norm_ProbVol_ATA_Left","Norm_ProbVol_ASTA_Left")])
rownames(corr_rvf.m) <- c("LA_Right","BLDI_Right","BLVPL_Right","BM_Right", "CMN_Right","CEN_Right", "AAA_Right","ATA_Right","ASTA_Right")
colnames(corr_rvf.m) <- c("LA_Left","BLDI_Left","BLVPL_Left","BM_Left", "CMN_Left","CEN_Left", "AAA_Left","ATA_Left","ASTA_Left")
corrplot(corr_rvf.m,method="number")

##Correlation with absolute (probabilistic volume)
##ALL
corr_prob <- cor(norm_mydata[,c("ProbVol_LA_Right","ProbVol_BLDI_Right","ProbVol_BLVPL_Right","ProbVol_BM_Right", "ProbVol_CMN_Right","ProbVol_CEN_Right", "ProbVol_AAA_Right","ProbVol_ATA_Right","ProbVol_ASTA_Right")],norm_mydata[,c("ProbVol_LA_Left","ProbVol_BLDI_Left","ProbVol_BLVPL_Left","ProbVol_BM_Left","ProbVol_CMN_Left","ProbVol_CEN_Left","ProbVol_AAA_Left","ProbVol_ATA_Left","ProbVol_ASTA_Left")])
rownames(corr_prob) <- c("LA_Right","BLDI_Right","BLVPL_Right","BM_Right", "CMN_Right","CEN_Right", "AAA_Right","ATA_Right","ASTA_Right")
colnames(corr_prob) <- c("LA_Left","BLDI_Left","BLVPL_Left","BM_Left", "CMN_Left","CEN_Left", "AAA_Left","ATA_Left","ASTA_Left")
corrplot(corr_prob,method="number")
##Female
corr_prob.f <- cor(norm_mydata.f[,c("ProbVol_LA_Right","ProbVol_BLDI_Right","ProbVol_BLVPL_Right","ProbVol_BM_Right", "ProbVol_CMN_Right","ProbVol_CEN_Right", "ProbVol_AAA_Right","ProbVol_ATA_Right","ProbVol_ASTA_Right")],norm_mydata.f[,c("ProbVol_LA_Left","ProbVol_BLDI_Left","ProbVol_BLVPL_Left","ProbVol_BM_Left","ProbVol_CMN_Left","ProbVol_CEN_Left","ProbVol_AAA_Left","ProbVol_ATA_Left","ProbVol_ASTA_Left")])
rownames(corr_prob.f) <- c("LA_Right","BLDI_Right","BLVPL_Right","BM_Right", "CMN_Right","CEN_Right", "AAA_Right","ATA_Right","ASTA_Right")
colnames(corr_prob.f) <- c("LA_Left","BLDI_Left","BLVPL_Left","BM_Left", "CMN_Left","CEN_Left", "AAA_Left","ATA_Left","ASTA_Left")
corrplot(corr_prob.f,method="number")
##Male
corr_prob.m <- cor(norm_mydata.m[,c("ProbVol_LA_Right","ProbVol_BLDI_Right","ProbVol_BLVPL_Right","ProbVol_BM_Right", "ProbVol_CMN_Right","ProbVol_CEN_Right", "ProbVol_AAA_Right","ProbVol_ATA_Right","ProbVol_ASTA_Right")],norm_mydata.m[,c("ProbVol_LA_Left","ProbVol_BLDI_Left","ProbVol_BLVPL_Left","ProbVol_BM_Left","ProbVol_CMN_Left","ProbVol_CEN_Left","ProbVol_AAA_Left","ProbVol_ATA_Left","ProbVol_ASTA_Left")])
rownames(corr_prob.m) <- c("LA_Right","BLDI_Right","BLVPL_Right","BM_Right", "CMN_Right","CEN_Right", "AAA_Right","ATA_Right","ASTA_Right")
colnames(corr_prob.m) <- c("LA_Left","BLDI_Left","BLVPL_Left","BM_Left", "CMN_Left","CEN_Left", "AAA_Left","ATA_Left","ASTA_Left")
corrplot(corr_prob.m,method="number")

p_ <- GGally::print_if_interactive
##Table for pairs
pairs_rvf_LA <- ggpairs((norm_mydata[,c("sex","Norm_ProbVol_LA_Right","Norm_ProbVol_LA_Left")]),lower=list(continuous="smooth",mapping = ggplot2::aes(colour=sex)), axisLabels='show')
pairs_rvf_BLDI <- ggpairs((norm_mydata[,c("sex","Norm_ProbVol_BLDI_Right","Norm_ProbVol_BLDI_Left")]),lower=list(continuous="smooth",mapping = ggplot2::aes(colour=sex)), axisLabels='show')
pairs_rvf_BLVPL <- ggpairs((norm_mydata[,c("sex","Norm_ProbVol_BLVPL_Right","Norm_ProbVol_BLVPL_Left")]),lower=list(continuous="smooth",mapping = ggplot2::aes(colour=sex)), axisLabels='show')
pairs_rvf_BM <- ggpairs((norm_mydata[,c("sex","Norm_ProbVol_BM_Right","Norm_ProbVol_BM_Left")]),lower=list(continuous="smooth",mapping = ggplot2::aes(colour=sex)), axisLabels='show')
pairs_rvf_CMN <- ggpairs((norm_mydata[,c("sex","Norm_ProbVol_CMN_Right","Norm_ProbVol_CMN_Left")]),lower=list(continuous="smooth",mapping = ggplot2::aes(colour=sex)), axisLabels='show')
pairs_rvf_CEN <- ggpairs((norm_mydata[,c("sex","Norm_ProbVol_CEN_Right","Norm_ProbVol_CEN_Left")]),lower=list(continuous="smooth",mapping = ggplot2::aes(colour=sex)), axisLabels='show')
pairs_rvf_AAA <- ggpairs((norm_mydata[,c("sex","Norm_ProbVol_AAA_Right","Norm_ProbVol_AAA_Left")]),lower=list(continuous="smooth",mapping = ggplot2::aes(colour=sex)), axisLabels='show')
pairs_rvf_ATA <- ggpairs((norm_mydata[,c("sex","Norm_ProbVol_ATA_Right","Norm_ProbVol_ATA_Left")]),lower=list(continuous="smooth",mapping = ggplot2::aes(colour=sex)), axisLabels='show')
pairs_rvf_ASTA <- ggpairs((norm_mydata[,c("sex","Norm_ProbVol_ASTA_Right","Norm_ProbVol_ASTA_Left")]),lower=list(continuous="smooth",mapping = ggplot2::aes(colour=sex)), axisLabels='show')

```

```{r Mean and CoV's for each subregion in each hemisphere}
name_mean <- c("ProbVol_LA_Right","ProbVol_LA_Left","ProbVol_BLDI_Right","ProbVol_BLDI_Left","ProbVol_BLVPL_Right","ProbVol_BLVPL_Left","ProbVol_BM_Right", "ProbVol_BM_Left","ProbVol_CMN_Right","ProbVol_CMN_Left","ProbVol_CEN_Right", "ProbVol_CEN_Left","ProbVol_AAA_Right","ProbVol_AAA_Left","ProbVol_ATA_Right","ProbVol_ATA_Left","ProbVol_ASTA_Right","ProbVol_ASTA_Left","ProbVol_TotalAmygdala_Right","ProbVol_TotalAmygdala_Left")

#Create empty data frame
##Females
abs.f <- data.frame()

#Loop through function and export table
for(i in name_mean) {
  val_m <- mean(mydata.f[[i]])
  val_cov <- sd(mydata.f[[i]], na.rm=TRUE)/ 
   mean(mydata.f[[i]], na.rm=TRUE)*100
  all_val <- cbind(val_m, val_cov)
  rownames(all_val) <- c(i)
  abs.f <- rbind(all_val, abs.f) 
}

#write.csv(abs.f, "Table 2 Female - Absolute Value Mean and CoV_12.23.19.csv")

##Males
abs.m <- data.frame()

#Loop through function and export table
for(i in name_mean) {
  val_m <- mean(mydata.m[[i]])
  val_cov <- sd(mydata.m[[i]], na.rm=TRUE)/ 
   mean(mydata.m[[i]], na.rm=TRUE)*100
  all_val <- cbind(val_m, val_cov)
  rownames(all_val) <- c(i)
  abs.m <- rbind(all_val, abs.m) 
}

#write.csv(abs.m, "Table 2 Male - Absolute Value Mean and CoV_12.23.19.csv")

##ALL
abs.all <- data.frame()

#Loop through function and export table
for(i in name_mean) {
  val_m <- mean(mydata[[i]])
  val_cov <- sd(mydata[[i]], na.rm=TRUE)/ 
   mean(mydata[[i]], na.rm=TRUE)*100
  all_val <- cbind(val_m, val_cov)
  rownames(all_val) <- c(i)
  abs.all <- rbind(all_val, abs.all) 
}

#write.csv(abs.all, "ALL - Absolute Value Mean and CoV_12.18.19.csv")

norm_name_mean <- c("Norm_ProbVol_LA_Right","Norm_ProbVol_LA_Left","Norm_ProbVol_BLDI_Right","Norm_ProbVol_BLDI_Left","Norm_ProbVol_BLVPL_Right","Norm_ProbVol_BLVPL_Left","Norm_ProbVol_BM_Right", "Norm_ProbVol_BM_Left","Norm_ProbVol_CMN_Right","Norm_ProbVol_CMN_Left","Norm_ProbVol_CEN_Right", "Norm_ProbVol_CEN_Left","Norm_ProbVol_AAA_Right","Norm_ProbVol_AAA_Left","Norm_ProbVol_ATA_Right","Norm_ProbVol_ATA_Left","Norm_ProbVol_ASTA_Right","Norm_ProbVol_ASTA_Left")

##Data for just females in norm'ed data
norm_mydata.f <- subset(norm_mydata, sex_orderedfactor=="f")

##Data for just males in norm'ed data
norm_mydata.m <- subset(norm_mydata, sex_orderedfactor=="m")

#Females
#Create empty data frame
norm.f <- data.frame()

#Loop through function and export table
for(i in norm_name_mean) {
  val_m <- mean(norm_mydata.f[[i]])
  val_cov <- sd(norm_mydata.f[[i]], na.rm=TRUE)/ 
   mean(norm_mydata.f[[i]], na.rm=TRUE)*100
  all_val <- cbind(val_m, val_cov)
  rownames(all_val) <- c(i)
  norm.f <- rbind(all_val, norm.f) 
}

#write.csv(norm.f, "Table 2 Female - RVF Value Mean and CoV_12.23.19.csv")

#Males
#Create empty data frame
norm.m <- data.frame()

#Loop through function and export table
for(i in norm_name_mean) {
  val_m <- mean(norm_mydata.m[[i]])
  val_cov <- sd(norm_mydata.m[[i]], na.rm=TRUE)/ 
   mean(norm_mydata.m[[i]], na.rm=TRUE)*100
  all_val <- cbind(val_m, val_cov)
  rownames(all_val) <- c(i)
  norm.m <- rbind(all_val, norm.m) 
}

#write.csv(norm.m, "Table 2 Male - RVF Value Mean and CoV_12.23.19.csv")

#ALL
#Create empty data frame
norm.all <- data.frame()

#Loop through function and export table
for(i in norm_name_mean) {
  val_m <- mean(norm_mydata[[i]])
  val_cov <- sd(norm_mydata[[i]], na.rm=TRUE)/ 
   mean(norm_mydata[[i]], na.rm=TRUE)*100
  all_val <- cbind(val_m, val_cov)
  rownames(all_val) <- c(i)
  norm.all <- rbind(all_val, norm.all) 
}

#write.csv(norm.all, "ALL - Norm Value Mean and CoV_12.18.19.csv")
```

```{r Reshape and Violin Plots}
##Gather data into nested types and plot Violin on same data plot (Relative Probabilies)

norm_data_long<-reshape(norm_mydata, varying=list(c("Norm_ProbVol_LA_Right","Norm_ProbVol_LA_Left"),c("Norm_ProbVol_BLDI_Right","Norm_ProbVol_BLDI_Left"),c("Norm_ProbVol_BLVPL_Right","Norm_ProbVol_BLVPL_Left"),c("Norm_ProbVol_BM_Right", "Norm_ProbVol_BM_Left"), c("Norm_ProbVol_CMN_Right","Norm_ProbVol_CMN_Left"), c("Norm_ProbVol_CEN_Right", "Norm_ProbVol_CEN_Left"),c("Norm_ProbVol_AAA_Right","Norm_ProbVol_AAA_Left"),c("Norm_ProbVol_ATA_Right","Norm_ProbVol_ATA_Left"),  c("Norm_ProbVol_ASTA_Right","Norm_ProbVol_ASTA_Left"),c("ProbVol_TotalAmygdala_Right","ProbVol_TotalAmygdala_Left"),c("ProbVol_LA_Right","ProbVol_LA_Left"),c("ProbVol_BLDI_Right","ProbVol_BLDI_Left"),c("ProbVol_BLVPL_Right","ProbVol_BLVPL_Left"),c("ProbVol_BM_Right", "ProbVol_BM_Left"), c("ProbVol_CMN_Right","ProbVol_CMN_Left"), c("ProbVol_CEN_Right","ProbVol_CEN_Left"),c("ProbVol_AAA_Right","ProbVol_AAA_Left"),c("ProbVol_ATA_Right","ProbVol_ATA_Left"),  c("ProbVol_ASTA_Right","ProbVol_ASTA_Left")),v.names=c("Norm_ProbVol_LA","Norm_ProbVol_BLDI","Norm_ProbVol_BLVPL","Norm_ProbVol_BM","Norm_ProbVol_CMN", "Norm_ProbVol_CEN","Norm_ProbVol_AAA", "Norm_ProbVol_ATA", "Norm_ProbVol_ASTA","ProbVol_TotalAmygdala","ProbVol_LA","ProbVol_BLDI","ProbVol_BLVPL","ProbVol_BM","ProbVol_CMN", "ProbVol_CEN","ProbVol_AAA", "ProbVol_ATA", "ProbVol_ASTA"), idvar="subject", timevar="hemisphere", times=c("right", "left"),direction="long")

norm_data_long_col<-reshape(norm_data_long, varying=list(c("Norm_ProbVol_LA","Norm_ProbVol_BLDI","Norm_ProbVol_BLVPL","Norm_ProbVol_BM", "Norm_ProbVol_CMN","Norm_ProbVol_CEN","Norm_ProbVol_AAA", "Norm_ProbVol_ATA", "Norm_ProbVol_ASTA","ProbVol_TotalAmygdala","ProbVol_LA","ProbVol_BLDI","ProbVol_BLVPL","ProbVol_BM", "ProbVol_CMN","ProbVol_CEN","ProbVol_AAA", "ProbVol_ATA", "ProbVol_ASTA")), idvar=c("subject", "hemisphere"), v.names="volume", timevar="subregion", times=c("LA","BLDI","BLVPL","BM", "CMN", "CEN","AAA", "ATA", "ASTA","Abs_Total","Abs_LA","Abs_BLDI","Abs_BLVPL","Abs_BM", "Abs_CMN", "Abs_CEN","Abs_AAA", "Abs_ATA", "Abs_ASTA"), direction="long")

subregions <- c("LA", "BLDI", "BLVPL", "BM", "CMN", "CEN", "AAA", "ATA", "ASTA")

p <- ggplot(data_long_col[data_long_col$subregion_orderedfactor %in% subregions,], aes(subregion_orderedfactor, volume))
fig2a=p + theme_bw()+geom_violin(aes(fill=factor(sex_orderedfactor)))+facet_grid(.~hemisphere)+xlab("Subregion")+ylab("Absolute Probabilistic Volumes (mm3)")+theme(text = element_text(size=14))+theme(axis.text.x = element_text(angle = 45)) + theme(axis.text.x = element_text(vjust = 0.7)) + theme(legend.position = c(0.92, 0.94), legend.title = element_blank(), legend.key.size = unit(.4,"cm"), legend.text=element_text(size=15), legend.background = element_rect(fill="transparent",colour="transparent"),text = element_text(size=20),axis.text.x = element_text(hjust=1)) + scale_fill_manual(values=c("coral1","blue")) + ggtitle("Violin Plots")

fig2b=p + theme_bw()+geom_boxplot(coef=3.5,aes(fill=factor(sex_orderedfactor)))+facet_grid(.~hemisphere)+xlab("Subregion")+ylab("Absolute Probabilistic Volumes (mm3)")+theme(text = element_text(size=14))+theme(axis.text.x = element_text(angle = 45)) + theme(axis.text.x = element_text(vjust = 0.7)) + theme(legend.position = c(0.92, 0.94), legend.title = element_blank(), legend.key.size = unit(.4,"cm"), legend.text=element_text(size=15), legend.background = element_rect(fill="transparent",colour="transparent"),text = element_text(size=20),axis.text.x = element_text(hjust=1)) + scale_fill_manual(values=c("coral1","blue")) + ggtitle("Box Plots")


norm_data_long_col$subregion_orderedfactor<-  factor(norm_data_long_col$subregion,  levels = c("LA", "BLDI", "BLVPL", "BM", "CMN", "CEN", "AAA", "ATA", "ASTA"))
levels(norm_data_long_col$sex_orderedfactor) <- c("Female", "Male")

p <- ggplot(norm_data_long_col[norm_data_long_col$subregion_orderedfactor %in% subregions,], aes(subregion_orderedfactor, volume))
fig2c=p + theme_bw()+geom_violin(aes(fill=factor(sex_orderedfactor)))+facet_grid(.~hemisphere)+xlab("Subregion")+ylab("Relative Volume Fraction (RVF)")+theme(text = element_text(size=14))+theme(axis.text.x = element_text(angle = 45)) + theme(axis.text.x = element_text(vjust = 0.7)) + theme(legend.position = c(0.92, 0.94), legend.title = element_blank(), legend.key.size = unit(.4,"cm"), legend.text=element_text(size=15), legend.background = element_rect(fill="transparent",colour="transparent") ,text = element_text(size=20),axis.text.x = element_text(hjust=1)) + scale_fill_manual(values=c("coral1","blue")) + ggtitle("Violin Plots")

fig2d=p + theme_bw()+geom_boxplot(coef=3.5,aes(fill=factor(sex_orderedfactor)),outlier.size=3)+facet_grid(.~hemisphere)+xlab("Subregion")+ylab("Relative Volume Fraction (RVF)")+theme(text = element_text(size=14))+theme(axis.text.x = element_text(angle = 45)) + theme(axis.text.x = element_text(vjust = 0.7)) + theme(legend.position = c(0.92, 0.94), legend.title = element_blank(), legend.key.size = unit(.4,"cm"), legend.text=element_text(size=15), legend.background = element_rect(fill="transparent",colour="transparent") ,text = element_text(size=20),axis.text.x = element_text(hjust=1)) + scale_fill_manual(values=c("coral1","blue")) + ggtitle("Box Plots")

##Export all plots together in one file
violin_box <- grid.arrange(fig2a,fig2c,fig2b,fig2d,nrow=2,ncol=2) 
#ggsave(filename = "RevisedFigures_Revisions/fig3ab_10.23.20.png",violin_box,width = 24, height = 14, dpi = 300, units = "in", device='png')

# Report descriptive statistics for relative Amygdala volumes
Relativevols <- summaryBy(volume ~ sex_orderedfactor * hemisphere *subregion_orderedfactor,  data=norm_data_long_col, FUN = mean_cov)
#print(Relativevols, digits=3)
#write.table(Relativevols, "RelativeVolumes.csv", sep=",", row.names=FALSE)
```


```{r Gamm models for volume~age+sex+age-by-sex}
##Going to try and use sex (as a factor), and relevel in model

#sex variable as a factor
norm_data_long_col$sex <- as.factor(norm_data_long_col$sex)

#List of all regions in amygdala for modeling and exporting
fm <- c("ASTA", "ATA","AAA", "CEN", "CMN","BM","BLVPL","BLDI", "LA")
fm_a <- c("Abs_ASTA", "Abs_ATA","Abs_AAA", "Abs_CEN", "Abs_CMN","Abs_BM","Abs_BLVPL","Abs_BLDI", "Abs_LA", "Abs_Total")

##For fm
# 9 = LA, 8 = BLDI, 7 = BLVPL, 6 = BM, 5 = CMN, 4 = CEN, 3 = AAA, 2 = ATA, 1 = ASTA
##For fm_a
# 10 = Total, 9 = LA, 8 = BLDI, 7 = BLVPL, 6 = BM, 5 = CMN, 4 = CEN, 3 = AAA, 2 = ATA, 1 = ASTA

##For RVF
#Create empty list to add gam() model results to check cubic relationship between volume, age, ICV, SES
gamm_age_sex_cu_icv <- vector(length(fm), mode = "list")
names(gamm_age_sex_cu_icv) <- fm
for(i in fm) {
gamm_age_sex_cu_icv[[i]] <- gamm(volume~s(age, bs = "cs", k = 4) + relevel(sex,"f") + s(age, by=sex_orderedfactor, bs = "cs", k = 4) + hemisphere + bmi_z + ICV + S_24g_1, data = subset(norm_data_long_col, subregion==i), random=list(subject=~1),method="ML")
}

##For absolute/probabilistic volumes
#Create empty list to add gam() model results to check cubic relationship between volume, age, ICV, SES
gamm_age_sex_cu_icv_abs <- vector(length(fm_a), mode = "list")
names(gamm_age_sex_cu_icv_abs) <- fm_a
for(i in fm_a) {
gamm_age_sex_cu_icv_abs[[i]] <- gamm(volume~s(age, bs = "cs", k = 4) + relevel(sex,"f") + s(age, by=sex_orderedfactor, bs = "cs", k = 4) + hemisphere + bmi_z + ICV + S_24g_1, data = subset(norm_data_long_col, subregion==i), random=list(subject=~1),method="ML")
}

#Create empty list to add gam() model results to check cubic relationship between volume, age
##RVF withOUT ICV
gamm_age_sex_cu <- vector(length(fm), mode = "list")
names(gamm_age_sex_cu) <- fm
for(i in fm) {
gamm_age_sex_cu[[i]] <- gamm(volume~s(age, bs = "cs", k = 4) + relevel(sex,"f") + s(age, by=sex_orderedfactor, bs = "cs", k = 4) + hemisphere + bmi_z + S_24g_1, data = subset(norm_data_long_col, subregion==i), random=list(subject=~1),method="ML")
}

```

```{r}
#Summary exports for GAMM
##For RVF+ICV
#Export summary values for s(age)+sex+s(age,by sex)+ICV
gamm_age_sex_cu_icv_sum <- data.frame("","","","")
#Loop through function and export table
for(i in fm) {
  para_val <- data.frame(summary(gamm_age_sex_cu_icv[[i]]$gam)$p.table)
  smooth_names <- data.frame("edf","Ref.df","F","p.value")
  colnames(smooth_names) <- c("Estimate","Std..Error","t.value","Pr...t..")
  smooth_val <- data.frame(summary(gamm_age_sex_cu_icv[[i]]$gam)$s.table)
  colnames(smooth_val) <- c("Estimate","Std..Error","t.value","Pr...t..")
  name_names <- data.frame("Region","Rsq Adj","N","")
  colnames(name_names) <- c("Estimate","Std..Error","t.value","Pr...t..")
  name_val <- data.frame(i,summary(gamm_age_sex_cu_icv[[i]]$gam)$r.sq,summary(gamm_age_sex_cu_icv[[i]]$gam)$n,"")
  colnames(name_val) <- c("Estimate","Std..Error","t.value","Pr...t..")
  all_val <- rbind(para_val, smooth_names, smooth_val, name_names, name_val)
  gamm_age_sex_cu_icv_sum <- cbind(all_val, gamm_age_sex_cu_icv_sum)
}
#write.csv(gamm_age_sex_cu_icv_sum, "RVF - Summary gam = s(age)+sex+s(age,by sex)+bmi+icv+ses_01.03.20_releveled.csv")

##For Absolute/Probabilistic Volume
#Export summary values for s(age)+sex+s(age,by sex)+ICV
gamm_age_sex_cu_icv_abs_sum <- data.frame("","","","")
#Loop through function and export table
for(i in fm_a) {
  para_val <- data.frame(summary(gamm_age_sex_cu_icv_abs[[i]]$gam)$p.table)
  smooth_names <- data.frame("edf","Ref.df","F","p.value")
  colnames(smooth_names) <- c("Estimate","Std..Error","t.value","Pr...t..")
  smooth_val <- data.frame(summary(gamm_age_sex_cu_icv_abs[[i]]$gam)$s.table)
  colnames(smooth_val) <- c("Estimate","Std..Error","t.value","Pr...t..")
  name_names <- data.frame("Region","Rsq Adj","N","")
  colnames(name_names) <- c("Estimate","Std..Error","t.value","Pr...t..")
  name_val <- data.frame(i,summary(gamm_age_sex_cu_icv_abs[[i]]$gam)$r.sq,summary(gamm_age_sex_cu_icv_abs[[i]]$gam)$n,"")
  colnames(name_val) <- c("Estimate","Std..Error","t.value","Pr...t..")
  all_val <- rbind(para_val, smooth_names, smooth_val, name_names, name_val)
  gamm_age_sex_cu_icv_abs_sum <- cbind(all_val, gamm_age_sex_cu_icv_abs_sum)
}
#write.csv(gamm_age_sex_cu_icv_abs_sum, "Absolute - Summary gam = s(age)+sex+s(age,by sex)+bmi+icv+ses_01.03.20_releveled.csv")

##RVF withOUT ICV
#Export summary values for s(age)+sex+s(age,by sex)
gamm_age_sex_cu_sum <- data.frame("","","","")
#Loop through function and export table
for(i in fm) {
  para_val <- data.frame(summary(gamm_age_sex_cu[[i]]$gam)$p.table)
  smooth_names <- data.frame("edf","Ref.df","F","p.value")
  colnames(smooth_names) <- c("Estimate","Std..Error","t.value","Pr...t..")
  smooth_val <- data.frame(summary(gamm_age_sex_cu[[i]]$gam)$s.table)
  colnames(smooth_val) <- c("Estimate","Std..Error","t.value","Pr...t..")
  name_names <- data.frame("Region","Rsq Adj","N","")
  colnames(name_names) <- c("Estimate","Std..Error","t.value","Pr...t..")
  name_val <- data.frame(i,summary(gamm_age_sex_cu[[i]]$gam)$r.sq,summary(gamm_age_sex_cu[[i]]$gam)$n,"")
  colnames(name_val) <- c("Estimate","Std..Error","t.value","Pr...t..")
  all_val <- rbind(para_val, smooth_names, smooth_val, name_names, name_val)
  gamm_age_sex_cu_sum <- cbind(all_val, gamm_age_sex_cu_sum)
}
#write.csv(gamm_age_sex_cu_sum, "RVF - Summary gam = s(age)+sex+s(age,by sex)+bmi+ses_01.03.20_releveled.csv")

```

```{r}
##Relative Volume Fractions

######## These are good plots, points by hemisphere, color coded for sex
    ##Still need to reorient the legend for hemisphere

    ###Changed the subject to be 1:16 instead of 1:32 so repeats for each hemisphere
    
library(utils)
#To set up variables and empty dataset to create predictions for desired regions
age = seq(min(10),max(17))
sex_orderedfactor=factor(rep(levels(norm_data_long_col$sex_orderedfactor), levels = levels(norm_data_long_col$sex_orderedfactor)))
bmi_z = mean(norm_data_long_col$bmi_z)
S_24g_1 = mean(norm_data_long_col$S_24g_1)
levels(norm_data_long_col$hemisphere) <- c("right", "left")
hemisphere=factor(rep(levels(norm_data_long_col$hemisphere), levels = levels(norm_data_long_col$hemisphere)))
frame.hem=expand.grid(sex_orderedfactor=sex_orderedfactor, age=age, hemisphere=hemisphere,bmi_z=bmi_z,S_24g_1=S_24g_1)
frame.hem$sex <- ifelse(sex_orderedfactor=="Male","m",ifelse(sex_orderedfactor=="Female","f",NA))
frame.hem$sex <- as.factor(frame.hem$sex)

    
#LA
predictLA=as.data.frame(frame.hem)
predictLA$volume <- 0
predictLA$subject <- 1:16
predictLA$volume<-predict(gamm_age_sex_cu[["LA"]]$gam,newdata=predictLA, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1"))
predictLA$se <- (predict(gamm_age_sex_cu[["LA"]]$gam,newdata=predictLA, posterior="all", type="response", level=.95,se=T,exclude=c("bmi_z","S_24g_1")))$se.fit
predictLA$lwr <- predictLA$volume - (1.95*predictLA$se)
predictLA$upr <- predictLA$volume + (1.95*predictLA$se)

##Plot results
  LA_rvf<-ggplot(data=subset(norm_data_long_col, subregion=="LA"),aes(x=age, y=volume, color=sex_orderedfactor))+
    xlim(10,17)+
    ylab("Relative Volume Fraction (RVF)")+
    xlab("Age (years)")+theme_bw()+ggtitle("LA")+
    geom_point(aes(color=sex_orderedfactor, shape=hemisphere),alpha=0.3)+
    geom_smooth(data=subset(predictLA, sex_orderedfactor=="Male"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictLA, sex_orderedfactor=="Female"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictLA, sex_orderedfactor=="Female"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictLA, sex_orderedfactor=="Female"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictLA, sex_orderedfactor=="Male"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictLA, sex_orderedfactor=="Male"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    theme(legend.position="none",axis.title.y=element_blank(),plot.title = element_text(hjust = 0.5))+scale_color_manual(values=c("coral1","blue"))
  
#BLVPL
predictBLVPL=as.data.frame(frame.hem)
predictBLVPL$volume <- 0
predictBLVPL$subject <- 1:16
predictBLVPL$volume<-predict(gamm_age_sex_cu[["BLVPL"]]$gam,newdata=predictBLVPL, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1"))
predictBLVPL$se <- (predict(gamm_age_sex_cu[["BLVPL"]]$gam,newdata=predictBLVPL, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1"),se=T))$se.fit
predictBLVPL$lwr <- predictBLVPL$volume - (1.95*predictBLVPL$se)
predictBLVPL$upr <- predictBLVPL$volume + (1.95*predictBLVPL$se)

##Plot results
  BLVPL_rvf<-ggplot(data=subset(norm_data_long_col, subregion=="BLVPL"),aes(x=age, y=volume, color=sex_orderedfactor))+
    xlim(10,17)+
    ylab("Relative Volume Fraction (RVF)")+
    xlab("Age (years)")+theme_bw()+ggtitle("BLVPL")+
    geom_point(aes(color=sex_orderedfactor, shape=hemisphere),alpha=0.3) + 
    geom_smooth(data=subset(predictBLVPL, sex_orderedfactor=="Male"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictBLVPL, sex_orderedfactor=="Female"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictBLVPL, sex_orderedfactor=="Female"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictBLVPL, sex_orderedfactor=="Female"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictBLVPL, sex_orderedfactor=="Male"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictBLVPL, sex_orderedfactor=="Male"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    theme(legend.position="none",axis.title.y=element_blank(),plot.title = element_text(hjust = 0.5))+scale_color_manual(values=c("coral1","blue"))
     
      
#CEN
predictCEN=as.data.frame(frame.hem)
predictCEN$volume <- 0
predictCEN$subject <- 1:16
predictCEN$volume<-predict(gamm_age_sex_cu[["CEN"]]$gam,newdata=predictCEN, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1"))
#Changed following line from newdata=predictBLVPL to predictCEN - 12.18.19
predictCEN$se <- (predict(gamm_age_sex_cu[["CEN"]]$gam,newdata=predictCEN, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1"),se=T))$se.fit
predictCEN$lwr <- predictCEN$volume - (1.95*predictCEN$se)
predictCEN$upr <- predictCEN$volume + (1.95*predictCEN$se)

##Plot results
  CEN_rvf<-ggplot(data=subset(norm_data_long_col, subregion=="CEN"),aes(x=age, y=volume, color=sex_orderedfactor))+
    xlim(10,17)+
    ylab("Relative Volume Fraction (RVF)")+
    xlab("Age (years)")+theme_bw()+ggtitle("CEN")+
    geom_point(aes(color=sex_orderedfactor, shape=hemisphere),alpha=0.3) + 
    geom_smooth(data=subset(predictCEN, sex_orderedfactor=="Male"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictCEN, sex_orderedfactor=="Female"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictCEN, sex_orderedfactor=="Female"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictCEN, sex_orderedfactor=="Female"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictCEN, sex_orderedfactor=="Male"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictCEN, sex_orderedfactor=="Male"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    theme(legend.position="none",axis.title.y=element_blank(),plot.title = element_text(hjust = 0.5))+scale_color_manual(values=c("coral1","blue"))
  
#ATA
predictATA=as.data.frame(frame.hem)
predictATA$volume <- 0
predictATA$subject <- 1:16
predictATA$volume<-predict(gamm_age_sex_cu[["ATA"]]$gam,newdata=predictATA, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1"))
predictATA$se <- (predict(gamm_age_sex_cu[["ATA"]]$gam,newdata=predictATA, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1"),se=T))$se.fit
predictATA$lwr <- predictATA$volume - (1.95*predictATA$se)
predictATA$upr <- predictATA$volume + (1.95*predictATA$se)

##Plot results
  ATA_rvf<-ggplot(data=subset(norm_data_long_col, subregion=="ATA"),aes(x=age, y=volume, color=sex_orderedfactor))+
    xlim(10,17)+
    ylab("Relative Volume Fraction (RVF)")+
    xlab("Age (years)")+theme_bw()+ggtitle("ATA")+
    geom_point(aes(color=sex_orderedfactor, shape=hemisphere),alpha=0.3) + 
    geom_smooth(data=subset(predictATA, sex_orderedfactor=="Male"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictATA, sex_orderedfactor=="Female"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictATA, sex_orderedfactor=="Female"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictATA, sex_orderedfactor=="Female"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictATA, sex_orderedfactor=="Male"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictATA, sex_orderedfactor=="Male"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    theme(legend.position="none",axis.title.y=element_blank(), plot.title = element_text(hjust = 0.5))+scale_color_manual(values=c("coral1","blue")) 

#ASTA
predictASTA=as.data.frame(frame.hem)
predictASTA$volume <- 0
predictASTA$subject <- 1:16
predictASTA$volume<-predict(gamm_age_sex_cu[["ASTA"]]$gam,newdata=predictASTA, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1"))
predictASTA$se <- (predict(gamm_age_sex_cu[["ASTA"]]$gam,newdata=predictASTA, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1"),se=T))$se.fit
predictASTA$lwr <- predictASTA$volume - (1.95*predictASTA$se)
predictASTA$upr <- predictASTA$volume + (1.95*predictASTA$se)

##Plot results
  ASTA_rvf<-ggplot(data=subset(norm_data_long_col, subregion=="ASTA"),aes(x=age, y=volume, color=sex_orderedfactor))+
    xlim(10,17)+
    ylab("Relative Volume Fraction (RVF)")+
    xlab("Age (years)")+theme_bw()+ggtitle("ASTA")+
    geom_point(aes(color=sex_orderedfactor, shape=hemisphere),alpha=0.3) + 
    geom_smooth(data=subset(predictASTA, sex_orderedfactor=="Male"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictASTA, sex_orderedfactor=="Female"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictASTA, sex_orderedfactor=="Female"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictASTA, sex_orderedfactor=="Female"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictASTA, sex_orderedfactor=="Male"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictASTA, sex_orderedfactor=="Male"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    theme(legend.position="none",axis.title.y=element_blank(), plot.title = element_text(hjust = 0.5))+scale_color_manual(values=c("coral1","blue"))   
  
#BLDI
predictBLDI=as.data.frame(frame.hem)
predictBLDI$volume <- 0
predictBLDI$subject <- 1:16
predictBLDI$volume<-predict(gamm_age_sex_cu[["BLDI"]]$gam,newdata=predictBLDI, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1"))
predictBLDI$se <- (predict(gamm_age_sex_cu[["BLDI"]]$gam,newdata=predictBLDI, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1"),se=T))$se.fit
predictBLDI$lwr <- predictBLDI$volume - (1.95*predictBLDI$se)
predictBLDI$upr <- predictBLDI$volume + (1.95*predictBLDI$se)

##Plot results
  BLDI_rvf<-ggplot(data=subset(norm_data_long_col, subregion=="BLDI"),aes(x=age, y=volume, color=sex_orderedfactor))+
    xlim(10,17)+
    ylab("Relative Volume Fraction (RVF)")+
    xlab("Age (years)")+theme_bw()+ggtitle("BLDI")+
    geom_point(aes(color=sex_orderedfactor, shape=hemisphere),alpha=0.3) + 
    geom_smooth(data=subset(predictBLDI, sex_orderedfactor=="Male"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictBLDI, sex_orderedfactor=="Female"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictBLDI, sex_orderedfactor=="Female"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictBLDI, sex_orderedfactor=="Female"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictBLDI, sex_orderedfactor=="Male"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictBLDI, sex_orderedfactor=="Male"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    theme(legend.position="none",axis.title.y=element_blank(), plot.title = element_text(hjust = 0.5))+scale_color_manual(values=c("coral1","blue"))   

#BM
predictBM=as.data.frame(frame.hem)
predictBM$volume <- 0
predictBM$subject <- 1:16
predictBM$volume<-predict(gamm_age_sex_cu[["BM"]]$gam,newdata=predictBM, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1"))
predictBM$se <- (predict(gamm_age_sex_cu[["BM"]]$gam,newdata=predictBM, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1"),se=T))$se.fit
predictBM$lwr <- predictBM$volume - (1.95*predictBM$se)
predictBM$upr <- predictBM$volume + (1.95*predictBM$se)

##Plot results
  BM_rvf<-ggplot(data=subset(norm_data_long_col, subregion=="BM"),aes(x=age, y=volume, color=sex_orderedfactor))+
    xlim(10,17)+
    ylab("Relative Volume Fraction (RVF)")+
    xlab("Age (years)")+theme_bw()+ggtitle("BM")+
    geom_point(aes(color=sex_orderedfactor, shape=hemisphere),alpha=0.3) + 
    geom_smooth(data=subset(predictBM, sex_orderedfactor=="Male"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictBM, sex_orderedfactor=="Female"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictBM, sex_orderedfactor=="Female"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictBM, sex_orderedfactor=="Female"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictBM, sex_orderedfactor=="Male"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictBM, sex_orderedfactor=="Male"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    theme(legend.position="none",axis.title.y=element_blank(), plot.title = element_text(hjust = 0.5))+scale_color_manual(values=c("coral1","blue"))     
  
#CMN
predictCMN=as.data.frame(frame.hem)
predictCMN$volume <- 0
predictCMN$subject <- 1:16
predictCMN$volume<-predict(gamm_age_sex_cu[["CMN"]]$gam,newdata=predictCMN, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1"))
predictCMN$se <- (predict(gamm_age_sex_cu[["CMN"]]$gam,newdata=predictCMN, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1"),se=T))$se.fit
predictCMN$lwr <- predictCMN$volume - (1.95*predictCMN$se)
predictCMN$upr <- predictCMN$volume + (1.95*predictCMN$se)

##Plot results
  CMN_rvf<-ggplot(data=subset(norm_data_long_col, subregion=="CMN"),aes(x=age, y=volume, color=sex_orderedfactor))+
    xlim(10,17)+
    ylab("Relative Volume Fraction (RVF)")+
    xlab("Age (years)")+theme_bw()+ggtitle("CMN")+
    geom_point(aes(color=sex_orderedfactor, shape=hemisphere),alpha=0.3) + 
    geom_smooth(data=subset(predictCMN, sex_orderedfactor=="Male"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictCMN, sex_orderedfactor=="Female"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictCMN, sex_orderedfactor=="Female"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictCMN, sex_orderedfactor=="Female"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictCMN, sex_orderedfactor=="Male"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictCMN, sex_orderedfactor=="Male"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    theme(legend.position="none",axis.title.y=element_blank(), plot.title = element_text(hjust = 0.5))+scale_color_manual(values=c("coral1","blue"))   
  
#AAA
predictAAA=as.data.frame(frame.hem)
predictAAA$volume <- 0
predictAAA$subject <- 1:16
predictAAA$volume<-predict(gamm_age_sex_cu[["AAA"]]$gam,newdata=predictAAA, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1"))
predictAAA$se <- (predict(gamm_age_sex_cu[["AAA"]]$gam,newdata=predictAAA, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1"),se=T))$se.fit
predictAAA$lwr <- predictAAA$volume - (1.95*predictAAA$se)
predictAAA$upr <- predictAAA$volume + (1.95*predictAAA$se)

##Plot results
  AAA_rvf<-ggplot(data=subset(norm_data_long_col, subregion=="AAA"),aes(x=age, y=volume, color=sex_orderedfactor))+
    xlim(10,17)+
    ylab("Relative Volume Fraction (RVF)")+
    xlab("Age (years)")+theme_bw()+ggtitle("AAA")+
    geom_point(aes(color=sex_orderedfactor, shape=hemisphere),alpha=0.3) + 
    geom_smooth(data=subset(predictAAA, sex_orderedfactor=="Male"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictAAA, sex_orderedfactor=="Female"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictAAA, sex_orderedfactor=="Female"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictAAA, sex_orderedfactor=="Female"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictAAA, sex_orderedfactor=="Male"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictAAA, sex_orderedfactor=="Male"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    theme(legend.position="none",axis.title.y=element_blank(), plot.title = element_text(hjust = 0.5))+scale_color_manual(values=c("coral1","blue"))   
      
#To add key in, also change position to bottom, and change legend.position="bottom"
#scale_color_manual(values=c("coral1","blue"),name="Sex")+scale_shape_discrete(name="Hemisphere") 
    
rvf_plot_s <- grid.arrange(LA_rvf, ASTA_rvf,CEN_rvf, ATA_rvf,BLVPL_rvf, ncol=5) 
rvf_plot_ns <- grid.arrange(BLDI_rvf, BM_rvf, CMN_rvf, AAA_rvf, ncol=4) 
  
#ggsave(rvf_plot_s,device="png",filename="RevisedFigures_Revisions/Fig5_RVF_08.31.20.png",dpi = 500,width=10,height=9, units = "in")

#no significant plot
#ggsave(rvf_plot_ns,device="png",filename="Fig3_RVF_01.03.20_ns.png",dpi = 500,width=10,height=9, units = "in")
```

```{r}
###Absolute volumes
    
library(utils)
#To set up variables and empty dataset to create predictions for desired regions
age = seq(min(10),max(17))
sex_orderedfactor=factor(rep(levels(norm_data_long_col$sex_orderedfactor), levels = levels(norm_data_long_col$sex_orderedfactor)))
sex=factor(rep(levels(norm_data_long_col$sex)))
bmi_z = mean(norm_data_long_col$bmi_z)
S_24g_1 = mean(norm_data_long_col$S_24g_1)
ICV = mean(norm_data_long_col$ICV)
levels(norm_data_long_col$hemisphere) <- c("right", "left")
hemisphere=factor(rep(levels(norm_data_long_col$hemisphere), levels = levels(norm_data_long_col$hemisphere)))
frame.hem=expand.grid(sex_orderedfactor=sex_orderedfactor,sex=sex, age=age, hemisphere=hemisphere,bmi_z=bmi_z,S_24g_1=S_24g_1,ICV=ICV)
frame.hem$sex <- ifelse(sex_orderedfactor=="Male","m",ifelse(sex_orderedfactor=="Female","f",NA))
frame.hem$sex <- as.factor(frame.hem$sex)
    
#BLVPL
predictBLVPL=as.data.frame(frame.hem)
predictBLVPL$volume <- 0
predictBLVPL$subject <- 1:16
predictBLVPL$volume<-predict(gamm_age_sex_cu_icv_abs[["Abs_BLVPL"]]$gam,newdata=predictBLVPL, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1","ICV"))
predictBLVPL$se <- (predict(gamm_age_sex_cu_icv_abs[["Abs_BLVPL"]]$gam,newdata=predictBLVPL, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1","ICV"),se=T))$se.fit
predictBLVPL$lwr <- predictBLVPL$volume - (1.95*predictBLVPL$se)
predictBLVPL$upr <- predictBLVPL$volume + (1.95*predictBLVPL$se)

##Plot results
  BLVPL_abs<-ggplot(data=subset(norm_data_long_col, subregion=="Abs_BLVPL"),aes(x=age, y=volume, color=sex_orderedfactor))+
    xlim(10,17)+
    ylab("Absolute Probabilistic Estimate (mm3)")+
    xlab("Age (years)")+theme_bw()+ggtitle("BLVPL")+
    geom_point(aes(color=sex_orderedfactor, shape=hemisphere),alpha=0.3) + 
    geom_smooth(data=subset(predictBLVPL, sex_orderedfactor=="Male"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictBLVPL, sex_orderedfactor=="Female"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictBLVPL, sex_orderedfactor=="Female"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictBLVPL, sex_orderedfactor=="Female"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictBLVPL, sex_orderedfactor=="Male"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictBLVPL, sex_orderedfactor=="Male"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    theme(legend.position="bottom",axis.title.y=element_blank(),plot.title = element_text(hjust = 0.5))+scale_color_manual(values=c("coral1","blue")) + guides(color=guide_legend(title="Sex")) + scale_shape_discrete(name = "Hemisphere", labels = c("Left","Right"))
     
      
#CEN
predictCEN=as.data.frame(frame.hem)
predictCEN$volume <- 0
predictCEN$subject <- 1:16
predictCEN$volume<-predict(gamm_age_sex_cu_icv_abs[["Abs_CEN"]]$gam,newdata=predictCEN, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1","ICV"))
predictCEN$se <- (predict(gamm_age_sex_cu_icv_abs[["Abs_CEN"]]$gam,newdata=predictCEN, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1","ICV"),se=T))$se.fit
predictCEN$lwr <- predictCEN$volume - (1.95*predictCEN$se)
predictCEN$upr <- predictCEN$volume + (1.95*predictCEN$se)

##Plot results
  CEN_abs<-ggplot(data=subset(norm_data_long_col, subregion=="Abs_CEN"),aes(x=age, y=volume, color=sex_orderedfactor))+
    xlim(10,17)+
    ylab("Absolute Probabilistic Estimate (mm3)")+
    xlab("Age (years)")+theme_bw()+ggtitle("CEN")+
    geom_point(aes(color=sex_orderedfactor, shape=hemisphere),alpha=0.3) + 
    geom_smooth(data=subset(predictCEN, sex_orderedfactor=="Male"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictCEN, sex_orderedfactor=="Female"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictCEN, sex_orderedfactor=="Female"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictCEN, sex_orderedfactor=="Female"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictCEN, sex_orderedfactor=="Male"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictCEN, sex_orderedfactor=="Male"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    theme(legend.position="none",axis.title.y=element_blank(),plot.title = element_text(hjust = 0.5))+scale_color_manual(values=c("coral1","blue"))
  
#ATA
predictATA=as.data.frame(frame.hem)
predictATA$volume <- 0
predictATA$subject <- 1:16
predictATA$volume<-predict(gamm_age_sex_cu_icv_abs[["Abs_ATA"]]$gam,newdata=predictATA, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1","ICV"))
predictATA$se <- (predict(gamm_age_sex_cu_icv_abs[["Abs_ATA"]]$gam,newdata=predictATA, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1","ICV"),se=T))$se.fit
predictATA$lwr <- predictATA$volume - (1.95*predictATA$se)
predictATA$upr <- predictATA$volume + (1.95*predictATA$se)

##Plot results
  ATA_abs<-ggplot(data=subset(norm_data_long_col, subregion=="Abs_ATA"),aes(x=age, y=volume, color=sex_orderedfactor))+
    xlim(10,17)+
    ylab("Absolute Probabilistic Estimate (mm3)")+
    xlab("Age (years)")+theme_bw()+ggtitle("ATA")+
    geom_point(aes(color=sex_orderedfactor, shape=hemisphere),alpha=0.3) + 
    geom_smooth(data=subset(predictATA, sex_orderedfactor=="Male"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictATA, sex_orderedfactor=="Female"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictATA, sex_orderedfactor=="Female"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictATA, sex_orderedfactor=="Female"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictATA, sex_orderedfactor=="Male"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictATA, sex_orderedfactor=="Male"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    theme(legend.position="none",axis.title.y=element_blank(), plot.title = element_text(hjust = 0.5))+scale_color_manual(values=c("coral1","blue")) 
  
#LA
predictLA=as.data.frame(frame.hem)
predictLA$volume <- 0
predictLA$subject <- 1:16
predictLA$volume<-predict(gamm_age_sex_cu_icv_abs[["Abs_LA"]]$gam,newdata=predictLA, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1","ICV"))
predictLA$se <- (predict(gamm_age_sex_cu_icv_abs[["Abs_LA"]]$gam,newdata=predictLA, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1","ICV"),se=T))$se.fit
predictLA$lwr <- predictLA$volume - (1.95*predictLA$se)
predictLA$upr <- predictLA$volume + (1.95*predictLA$se)

##Plot results
  LA_abs<-ggplot(data=subset(norm_data_long_col, subregion=="Abs_LA"),aes(x=age, y=volume, color=sex_orderedfactor))+
    xlim(10,17)+
    ylab("Absolute Probabilistic Estimate (mm3)")+
    xlab("Age (years)")+theme_bw()+ggtitle("LA")+
    geom_point(aes(color=sex_orderedfactor, shape=hemisphere),alpha=0.3) + 
    geom_smooth(data=subset(predictLA, sex_orderedfactor=="Male"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictLA, sex_orderedfactor=="Female"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictLA, sex_orderedfactor=="Female"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictLA, sex_orderedfactor=="Female"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictLA, sex_orderedfactor=="Male"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictLA, sex_orderedfactor=="Male"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    theme(legend.position="none",axis.title.y=element_blank(),plot.title = element_text(hjust = 0.5))+scale_color_manual(values=c("coral1","blue"))
  
#ASTA
predictASTA=as.data.frame(frame.hem)
predictASTA$volume <- 0
predictASTA$subject <- 1:16
predictASTA$volume<-predict(gamm_age_sex_cu_icv_abs[["Abs_ASTA"]]$gam,newdata=predictASTA, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1","ICV"))
predictASTA$se <- (predict(gamm_age_sex_cu_icv_abs[["Abs_ASTA"]]$gam,newdata=predictASTA, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1","ICV"),se=T))$se.fit
predictASTA$lwr <- predictASTA$volume - (1.95*predictASTA$se)
predictASTA$upr <- predictASTA$volume + (1.95*predictASTA$se)

##Plot results
  ASTA_abs<-ggplot(data=subset(norm_data_long_col, subregion=="Abs_ASTA"),aes(x=age, y=volume, color=sex_orderedfactor))+
    xlim(10,17)+
    ylab("Absolute Probabilistic Estimate (mm3)")+
    xlab("Age (years)")+theme_bw()+ggtitle("ASTA")+
    geom_point(aes(color=sex_orderedfactor, shape=hemisphere),alpha=0.3) + 
    geom_smooth(data=subset(predictASTA, sex_orderedfactor=="Male"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictASTA, sex_orderedfactor=="Female"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictASTA, sex_orderedfactor=="Female"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictASTA, sex_orderedfactor=="Female"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictASTA, sex_orderedfactor=="Male"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictASTA, sex_orderedfactor=="Male"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    theme(legend.position="none",axis.title.y=element_blank(),plot.title = element_text(hjust = 0.5))+scale_color_manual(values=c("coral1","blue"))
  
#BLDI
predictBLDI=as.data.frame(frame.hem)
predictBLDI$volume <- 0
predictBLDI$subject <- 1:16
predictBLDI$volume<-predict(gamm_age_sex_cu_icv_abs[["Abs_BLDI"]]$gam,newdata=predictBLDI, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1","ICV"))
predictBLDI$se <- (predict(gamm_age_sex_cu_icv_abs[["Abs_BLDI"]]$gam,newdata=predictBLDI, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1","ICV"),se=T))$se.fit
predictBLDI$lwr <- predictBLDI$volume - (1.95*predictBLDI$se)
predictBLDI$upr <- predictBLDI$volume + (1.95*predictBLDI$se)

##Plot results
  BLDI_abs<-ggplot(data=subset(norm_data_long_col, subregion=="Abs_BLDI"),aes(x=age, y=volume, color=sex_orderedfactor))+
    xlim(10,17)+
    ylab("Absolute Probabilistic Estimate (mm3)")+
    xlab("Age (years)")+theme_bw()+ggtitle("BLDI")+
    geom_point(aes(color=sex_orderedfactor, shape=hemisphere),alpha=0.3) + 
    geom_smooth(data=subset(predictBLDI, sex_orderedfactor=="Male"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictBLDI, sex_orderedfactor=="Female"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictBLDI, sex_orderedfactor=="Female"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictBLDI, sex_orderedfactor=="Female"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictBLDI, sex_orderedfactor=="Male"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictBLDI, sex_orderedfactor=="Male"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    theme(legend.position="none",axis.title.y=element_blank(),plot.title = element_text(hjust = 0.5))+scale_color_manual(values=c("coral1","blue"))
     
#BM
predictBM=as.data.frame(frame.hem)
predictBM$volume <- 0
predictBM$subject <- 1:16
predictBM$volume<-predict(gamm_age_sex_cu_icv_abs[["Abs_BM"]]$gam,newdata=predictBM, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1","ICV"))
predictBM$se <- (predict(gamm_age_sex_cu_icv_abs[["Abs_BM"]]$gam,newdata=predictBM, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1","ICV"),se=T))$se.fit
predictBM$lwr <- predictBM$volume - (1.95*predictBM$se)
predictBM$upr <- predictBM$volume + (1.95*predictBM$se)

##Plot results
  BM_abs<-ggplot(data=subset(norm_data_long_col, subregion=="Abs_BM"),aes(x=age, y=volume, color=sex_orderedfactor))+
    xlim(10,17)+
    ylab("Absolute Probabilistic Estimate (mm3)")+
    xlab("Age (years)")+theme_bw()+ggtitle("BM")+
    geom_point(aes(color=sex_orderedfactor, shape=hemisphere),alpha=0.3) + 
    geom_smooth(data=subset(predictBM, sex_orderedfactor=="Male"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictBM, sex_orderedfactor=="Female"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictBM, sex_orderedfactor=="Female"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictBM, sex_orderedfactor=="Female"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictBM, sex_orderedfactor=="Male"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictBM, sex_orderedfactor=="Male"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    theme(legend.position="none",axis.title.y=element_blank(),plot.title = element_text(hjust = 0.5))+scale_color_manual(values=c("coral1","blue"))
          
#CMN
predictCMN=as.data.frame(frame.hem)
predictCMN$volume <- 0
predictCMN$subject <- 1:16
predictCMN$volume<-predict(gamm_age_sex_cu_icv_abs[["Abs_CMN"]]$gam,newdata=predictCMN, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1","ICV"))
predictCMN$se <- (predict(gamm_age_sex_cu_icv_abs[["Abs_CMN"]]$gam,newdata=predictCMN, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1","ICV"),se=T))$se.fit
predictCMN$lwr <- predictCMN$volume - (1.95*predictCMN$se)
predictCMN$upr <- predictCMN$volume + (1.95*predictCMN$se)

##Plot results
  CMN_abs<-ggplot(data=subset(norm_data_long_col, subregion=="Abs_CMN"),aes(x=age, y=volume, color=sex_orderedfactor))+
    xlim(10,17)+
    ylab("Absolute Probabilistic Estimate (mm3)")+
    xlab("Age (years)")+theme_bw()+ggtitle("CMN")+
    geom_point(aes(color=sex_orderedfactor, shape=hemisphere),alpha=0.3) + 
    geom_smooth(data=subset(predictCMN, sex_orderedfactor=="Male"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictCMN, sex_orderedfactor=="Female"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictCMN, sex_orderedfactor=="Female"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictCMN, sex_orderedfactor=="Female"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictCMN, sex_orderedfactor=="Male"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictCMN, sex_orderedfactor=="Male"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    theme(legend.position="none",axis.title.y=element_blank(),plot.title = element_text(hjust = 0.5))+scale_color_manual(values=c("coral1","blue"))
 
#AAA
predictAAA=as.data.frame(frame.hem)
predictAAA$volume <- 0
predictAAA$subject <- 1:16
predictAAA$volume<-predict(gamm_age_sex_cu_icv_abs[["Abs_AAA"]]$gam,newdata=predictAAA, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1","ICV"))
predictAAA$se <- (predict(gamm_age_sex_cu_icv_abs[["Abs_AAA"]]$gam,newdata=predictAAA, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1","ICV"),se=T))$se.fit
predictAAA$lwr <- predictAAA$volume - (1.95*predictAAA$se)
predictAAA$upr <- predictAAA$volume + (1.95*predictAAA$se)

##Plot results
  AAA_abs<-ggplot(data=subset(norm_data_long_col, subregion=="Abs_AAA"),aes(x=age, y=volume, color=sex_orderedfactor))+
    xlim(10,17)+
    ylab("Absolute Probabilistic Estimate (mm3)")+
    xlab("Age (years)")+theme_bw()+ggtitle("AAA")+
    geom_point(aes(color=sex_orderedfactor, shape=hemisphere),alpha=0.3) + 
    geom_smooth(data=subset(predictAAA, sex_orderedfactor=="Male"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictAAA, sex_orderedfactor=="Female"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictAAA, sex_orderedfactor=="Female"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictAAA, sex_orderedfactor=="Female"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictAAA, sex_orderedfactor=="Male"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictAAA, sex_orderedfactor=="Male"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    theme(legend.position="none",axis.title.y=element_blank(),plot.title = element_text(hjust = 0.5))+scale_color_manual(values=c("coral1","blue"))
             
#Total
predictTotal=as.data.frame(frame.hem)
predictTotal$volume <- 0
predictTotal$subject <- 1:16
predictTotal$volume<-predict(gamm_age_sex_cu_icv_abs[["Abs_Total"]]$gam,newdata=predictTotal, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1","ICV"))
predictTotal$se <- (predict(gamm_age_sex_cu_icv_abs[["Abs_Total"]]$gam,newdata=predictTotal, posterior="all", type="response", level=.95,exclude=c("bmi_z","S_24g_1","ICV"),se=T))$se.fit
predictTotal$lwr <- predictTotal$volume - (1.95*predictTotal$se)
predictTotal$upr <- predictTotal$volume + (1.95*predictTotal$se)

##Plot results
  Total_abs<-ggplot(data=subset(norm_data_long_col, subregion=="Abs_Total"),aes(x=age, y=volume, color=sex_orderedfactor))+
    xlim(10,17)+
    ylab("Absolute Probabilistic Estimate (mm3)")+
    xlab("Age (years)")+theme_bw()+ggtitle("Total")+
    geom_point(aes(color=sex_orderedfactor, shape=hemisphere),alpha=0.3) + 
    geom_smooth(data=subset(predictTotal, sex_orderedfactor=="Male"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictTotal, sex_orderedfactor=="Female"),aes(x=age, y=volume),se = FALSE)+
    geom_smooth(data=subset(predictTotal, sex_orderedfactor=="Female"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictTotal, sex_orderedfactor=="Female"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictTotal, sex_orderedfactor=="Male"),aes(x=age, y=lwr),se = FALSE,linetype="dashed",size=0.5)+
    geom_smooth(data=subset(predictTotal, sex_orderedfactor=="Male"),aes(x=age, y=upr),se = FALSE,linetype="dashed",size=0.5)+
    theme(legend.position="none",axis.title.y=element_blank(),plot.title = element_text(hjust = 0.5))+scale_color_manual(values=c("coral1","blue"))
     
  
#To add key in, also change position to bottom, and change legend.position="bottom"
#scale_color_manual(values=c("coral1","blue"),name="Sex")+scale_shape_discrete(name="Hemisphere") 
    
abs_plot_s <- grid.arrange(BLVPL_abs, ATA_abs, CEN_abs, ncol=5)   
abs_plot_ns1 <- grid.arrange(LA_abs, ASTA_abs, BLDI_abs, ncol=3)   
abs_plot_ns2 <- grid.arrange(BM_abs, CMN_abs, AAA_abs, Total_abs, ncol=4) 

#ggsave(abs_plot_s,device="png",filename="RevisedFigures_Revisions/Fig4_Abs_08.31.20.png",dpi = 500,width=10,height=9, units = "in")

#ggsave(abs_plot_ns1,device="png",filename="Fig3c_Abs_01.03.20.png",dpi = 500,width=10,height=9, units = "in")
#ggsave(abs_plot_ns2,device="png",filename="Fig3d_Abs_01.03.20.png",dpi = 500,width=10,height=9, units = "in")
```


```{r}
##Plot the predicted values for the regions that only have a main sex effect: only seen in Absolute volumes

###Model == gamm_age_sex_cu_icv_abs <- gamm(volume~s(age, bs = "cs", k = 4) + relevel(sex,"f") + s(age, by=sex_orderedfactor, bs = "cs", k = 4) + hemisphere + bmi_z + ICV + S_24g_1, data = subset(norm_data_long_col, subregion==i), random=list(subject=~1),method="ML")

##LA
plot_abs_LA <- subset(norm_data_long_col, subregion==c("Abs_LA"),select=c("sex","hemisphere","ICV","volume","subject","subregion","bmi_z","sex_orderedfactor","S_24g_1","age"))
plot_abs_LA$predictLA <- predict(gamm_age_sex_cu_icv_abs[["Abs_LA"]]$gam,newdata=plot_abs_LA, posterior="all", type="response", level=.95)
plot_abs_LA$se <- predict(gamm_age_sex_cu_icv_abs[["Abs_LA"]]$gam,newdata=plot_abs_LA, posterior="all", type="response", level=.95, se=T)$se.fit

##Column Plot for Abs Vol
##Means for LA
mean_LA_f <- mean(plot_abs_LA[plot_abs_LA$sex=="f",]$predictLA)
mean_LA_m <- mean(plot_abs_LA[plot_abs_LA$sex=="m",]$predictLA)
##SDs for LA
se_LA_f <- mean(plot_abs_LA[plot_abs_LA$sex=="f",]$se)
se_LA_m <- mean(plot_abs_LA[plot_abs_LA$sex=="m",]$se)
##Create dataframe
sex_LA_df <- data.frame("sex" = c("Female","Male"),"mean" = c(mean_LA_f,mean_LA_m), "se" = c(se_LA_f,se_LA_m))
#Plot each group
abs_LA <- ggplot(sex_LA_df, aes(y=mean,x=sex,fill=sex)) + geom_col() + ggtitle("LA")+ geom_errorbar(aes(ymin=mean-se,ymax=mean+se))+scale_fill_manual(values=c("coral1","blue")) +
    theme(legend.position="none",axis.title.y=element_blank(),axis.title.x=element_blank(), plot.title = element_text(hjust = 0.5))+ geom_text(aes(label=round(sex_LA_df$mean,digits=2),vjust = 2))
#+labs(title="Difference in Total Amygdala Volume by Sex",x="Sex",y="Mean Abs LA Volume")

##BLDI
plot_abs_BLDI <- subset(norm_data_long_col, subregion==c("Abs_BLDI"),select=c("sex","hemisphere","ICV","volume","subject","subregion","bmi_z","sex_orderedfactor","S_24g_1","age"))
plot_abs_BLDI$predictBLDI <- predict(gamm_age_sex_cu_icv_abs[["Abs_BLDI"]]$gam,newdata=plot_abs_BLDI, posterior="all", type="response", level=.95)
plot_abs_BLDI$se <- predict(gamm_age_sex_cu_icv_abs[["Abs_BLDI"]]$gam,newdata=plot_abs_BLDI, posterior="all", type="response", level=.95, se=T)$se.fit
##Column Plot for Abs Vol
##Means
mean_BLDI_f <- mean(plot_abs_BLDI[plot_abs_BLDI$sex=="f",]$predictBLDI)
mean_BLDI_m <- mean(plot_abs_BLDI[plot_abs_BLDI$sex=="m",]$predictBLDI)
##SDs
se_BLDI_f <- mean(plot_abs_BLDI[plot_abs_BLDI$sex=="f",]$se)
se_BLDI_m <- mean(plot_abs_BLDI[plot_abs_BLDI$sex=="m",]$se)
##Create dataframe
sex_BLDI_df <- data.frame("sex" = c("Female","Male"),"mean" = c(mean_BLDI_f,mean_BLDI_m), "se" = c(se_BLDI_f,se_BLDI_m))
#Plot each group
abs_BLDI <- ggplot(sex_BLDI_df, aes(y=mean,x=sex,fill=sex)) + geom_col() + ggtitle("BLDI")+ geom_errorbar(aes(ymin=mean-se,ymax=mean+se))+scale_fill_manual(values=c("coral1","blue")) +
    theme(legend.position="none",axis.title.y=element_blank(),axis.title.x=element_blank(), plot.title = element_text(hjust = 0.5))+ geom_text(aes(label=round(sex_BLDI_df$mean,digits=2),vjust = 2))

##BM
plot_abs_BM <- subset(norm_data_long_col, subregion==c("Abs_BM"),select=c("sex","hemisphere","ICV","volume","subject","subregion","bmi_z","sex_orderedfactor","S_24g_1","age"))
plot_abs_BM$predictBM <- predict(gamm_age_sex_cu_icv_abs[["Abs_BM"]]$gam,newdata=plot_abs_BM, posterior="all", type="response", level=.95)
plot_abs_BM$se <- predict(gamm_age_sex_cu_icv_abs[["Abs_BM"]]$gam,newdata=plot_abs_BM, posterior="all", type="response", level=.95, se=T)$se.fit
##Column Plot for Abs Vol
##Means
mean_BM_f <- mean(plot_abs_BM[plot_abs_BM$sex=="f",]$predictBM)
mean_BM_m <- mean(plot_abs_BM[plot_abs_BM$sex=="m",]$predictBM)
##SDs
se_BM_f <- mean(plot_abs_BM[plot_abs_BM$sex=="f",]$se)
se_BM_m <- mean(plot_abs_BM[plot_abs_BM$sex=="m",]$se)
##Create dataframe
sex_BM_df <- data.frame("sex" = c("Female","Male"),"mean" = c(mean_BM_f,mean_BM_m), "se" = c(se_BM_f,se_BM_m))
#Plot each group
abs_BM <- ggplot(sex_BM_df, aes(y=mean,x=sex,fill=sex)) + geom_col() + ggtitle("BM")+ geom_errorbar(aes(ymin=mean-se,ymax=mean+se))+scale_fill_manual(values=c("coral1","blue")) +
    theme(legend.position="none",axis.title.y=element_blank(),axis.title.x=element_blank(), plot.title = element_text(hjust = 0.5))+ geom_text(aes(label=round(sex_BM_df$mean,digits=2),vjust = 2))

##CMN
plot_abs_CMN <- subset(norm_data_long_col, subregion==c("Abs_CMN"),select=c("sex","hemisphere","ICV","volume","subject","subregion","bmi_z","sex_orderedfactor","S_24g_1","age"))
plot_abs_CMN$predictCMN <- predict(gamm_age_sex_cu_icv_abs[["Abs_CMN"]]$gam,newdata=plot_abs_CMN, posterior="all", type="response", level=.95)
plot_abs_CMN$se <- predict(gamm_age_sex_cu_icv_abs[["Abs_CMN"]]$gam,newdata=plot_abs_CMN, posterior="all", type="response", level=.95, se=T)$se.fit
##Column Plot for Abs Vol
##Means
mean_CMN_f <- mean(plot_abs_CMN[plot_abs_CMN$sex=="f",]$predictCMN)
mean_CMN_m <- mean(plot_abs_CMN[plot_abs_CMN$sex=="m",]$predictCMN)
##SDs
se_CMN_f <- mean(plot_abs_CMN[plot_abs_CMN$sex=="f",]$se)
se_CMN_m <- mean(plot_abs_CMN[plot_abs_CMN$sex=="m",]$se)
##Create dataframe
sex_CMN_df <- data.frame("sex" = c("Female","Male"),"mean" = c(mean_CMN_f,mean_CMN_m), "se" = c(se_CMN_f,se_CMN_m))
#Plot each group
abs_CMN <- ggplot(sex_CMN_df, aes(y=mean,x=sex,fill=sex)) + geom_col() + ggtitle("CMN")+ geom_errorbar(aes(ymin=mean-se,ymax=mean+se))+scale_fill_manual(values=c("coral1","blue")) +
    theme(legend.position="none",axis.title.y=element_blank(),axis.title.x=element_blank(), plot.title = element_text(hjust = 0.5))+ geom_text(aes(label=round(sex_CMN_df$mean,digits=2),vjust = 2))

##AAA
plot_abs_AAA <- subset(norm_data_long_col, subregion==c("Abs_AAA"),select=c("sex","hemisphere","ICV","volume","subject","subregion","bmi_z","sex_orderedfactor","S_24g_1","age"))
plot_abs_AAA$predictAAA <- predict(gamm_age_sex_cu_icv_abs[["Abs_AAA"]]$gam,newdata=plot_abs_AAA, posterior="all", type="response", level=.95)
plot_abs_AAA$se <- predict(gamm_age_sex_cu_icv_abs[["Abs_AAA"]]$gam,newdata=plot_abs_AAA, posterior="all", type="response", level=.95, se=T)$se.fit
##Column Plot for Abs Vol
##Means
mean_AAA_f <- mean(plot_abs_AAA[plot_abs_AAA$sex=="f",]$predictAAA)
mean_AAA_m <- mean(plot_abs_AAA[plot_abs_AAA$sex=="m",]$predictAAA)
##SDs
se_AAA_f <- mean(plot_abs_AAA[plot_abs_AAA$sex=="f",]$se)
se_AAA_m <- mean(plot_abs_AAA[plot_abs_AAA$sex=="m",]$se)
##Create dataframe
sex_AAA_df <- data.frame("sex" = c("Female","Male"),"mean" = c(mean_AAA_f,mean_AAA_m), "se" = c(se_AAA_f,se_AAA_m))
#Plot each group
abs_AAA <- ggplot(sex_AAA_df, aes(y=mean,x=sex,fill=sex)) + geom_col() + ggtitle("AAA")+ geom_errorbar(aes(ymin=mean-se,ymax=mean+se))+scale_fill_manual(values=c("coral1","blue")) +
    theme(legend.position="none",axis.title.y=element_blank(),axis.title.x=element_blank(), plot.title = element_text(hjust = 0.5))+ geom_text(aes(label=round(sex_AAA_df$mean,digits=2),vjust = 2))

##Total
plot_abs_Total <- subset(norm_data_long_col, subregion==c("Abs_Total"),select=c("sex","hemisphere","ICV","volume","subject","subregion","bmi_z","sex_orderedfactor","S_24g_1","age"))
plot_abs_Total$predictTotal <- predict(gamm_age_sex_cu_icv_abs[["Abs_Total"]]$gam,newdata=plot_abs_Total, posterior="all", type="response", level=.95)
plot_abs_Total$se <- predict(gamm_age_sex_cu_icv_abs[["Abs_Total"]]$gam,newdata=plot_abs_Total, posterior="all", type="response", level=.95, se=T)$se.fit
##Column Plot for Abs Vol
##Means
mean_Total_f <- mean(plot_abs_Total[plot_abs_Total$sex=="f",]$predictTotal)
mean_Total_m <- mean(plot_abs_Total[plot_abs_Total$sex=="m",]$predictTotal)
##SDs
se_Total_f <- mean(plot_abs_Total[plot_abs_Total$sex=="f",]$se)
se_Total_m <- mean(plot_abs_Total[plot_abs_Total$sex=="m",]$se)
##Create dataframe
sex_Total_df <- data.frame("sex" = c("Female","Male"),"mean" = c(mean_Total_f,mean_Total_m), "se" = c(se_Total_f,se_Total_m))
#Plot each group
abs_Total <- ggplot(sex_Total_df, aes(y=mean,x=sex,fill=sex)) + geom_col() + ggtitle("Total")+ geom_errorbar(aes(ymin=mean-se,ymax=mean+se))+scale_fill_manual(values=c("coral1","blue")) +
    theme(legend.position="none",axis.title.y=element_blank(),axis.title.x=element_blank(), plot.title = element_text(hjust = 0.5)) + geom_text(aes(label=round(sex_Total_df$mean,digits=2),vjust = 2))


abs_main_sex <- grid.arrange(abs_LA, abs_BLDI, abs_BM, abs_CMN, abs_AAA, abs_Total, ncol=3)   

#ggsave(abs_main_sex,device="png",filename="RevisedFigures_Revisions/FigS2_Abs_MainSexEffect_8.31.20.png",dpi = 500,width=10,height=5, units = "in")
```


```{r}
##Create pie chart of predictions for each region
##MALES
plot_abs.m <- subset(norm_data_long_col, select=c("sex","hemisphere","ICV","volume","subject","subregion","bmi_z","sex_orderedfactor","S_24g_1","age"),sex=="m")
plot_abs.m$pAbs_Total <- predict(gamm_age_sex_cu_icv_abs[["Abs_Total"]]$gam,newdata=subset(plot_abs.m,subregion=="Abs_Total"), posterior="all", type="response", level=.95)
plot_abs.m$pAbs_LA <- predict(gamm_age_sex_cu_icv_abs[["Abs_LA"]]$gam,newdata=subset(plot_abs.m,subregion=="Abs_LA"), posterior="all", type="response", level=.95)
plot_abs.m$pAbs_BLDI <- predict(gamm_age_sex_cu_icv_abs[["Abs_BLDI"]]$gam,newdata=subset(plot_abs.m,subregion=="Abs_BLDI"), posterior="all", type="response", level=.95)
plot_abs.m$pAbs_BLVPL <- predict(gamm_age_sex_cu_icv_abs[["Abs_BLVPL"]]$gam,newdata=subset(plot_abs.m,subregion=="Abs_BLVPL"), posterior="all", type="response", level=.95)
plot_abs.m$pAbs_BM <- predict(gamm_age_sex_cu_icv_abs[["Abs_BM"]]$gam,newdata=subset(plot_abs.m,subregion=="Abs_BM"), posterior="all", type="response", level=.95)
plot_abs.m$pAbs_CMN <- predict(gamm_age_sex_cu_icv_abs[["Abs_CMN"]]$gam,newdata=subset(plot_abs.m,subregion=="Abs_CMN"), posterior="all", type="response", level=.95)
plot_abs.m$pAbs_CEN <- predict(gamm_age_sex_cu_icv_abs[["Abs_CEN"]]$gam,newdata=subset(plot_abs.m,subregion=="Abs_CEN"), posterior="all", type="response", level=.95)
plot_abs.m$pAbs_AAA <- predict(gamm_age_sex_cu_icv_abs[["Abs_AAA"]]$gam,newdata=subset(plot_abs.m,subregion=="Abs_AAA"), posterior="all", type="response", level=.95)
plot_abs.m$pAbs_ATA <- predict(gamm_age_sex_cu_icv_abs[["Abs_ATA"]]$gam,newdata=subset(plot_abs.m,subregion=="Abs_ATA"), posterior="all", type="response", level=.95)
plot_abs.m$pAbs_ASTA <- predict(gamm_age_sex_cu_icv_abs[["Abs_ASTA"]]$gam,newdata=subset(plot_abs.m,subregion=="Abs_ASTA"), posterior="all", type="response", level=.95)

y <- data.frame(matrix(ncol = 10, nrow = 1))
colnames(y) <- c("Abs_ASTA", "Abs_ATA","Abs_AAA", "Abs_CEN", "Abs_CMN","Abs_BM","Abs_BLVPL","Abs_BLDI", "Abs_LA", "Abs_Total")
rownames(y) <- "mean_Abs_PreVol"
y$Abs_ASTA <- mean(plot_abs.m$pAbs_ASTA)
y$Abs_ATA <- mean(plot_abs.m$pAbs_ATA)
y$Abs_AAA <- mean(plot_abs.m$pAbs_AAA)
y$Abs_CEN <- mean(plot_abs.m$pAbs_CEN)
y$Abs_CMN <- mean(plot_abs.m$pAbs_CMN)
y$Abs_BM <- mean(plot_abs.m$pAbs_BM)
y$Abs_BLVPL <- mean(plot_abs.m$pAbs_BLVPL)
y$Abs_BLDI <- mean(plot_abs.m$pAbs_BLDI)
y$Abs_LA <- mean(plot_abs.m$pAbs_LA)
y$Abs_Total <- mean(plot_abs.m$pAbs_Total)

```


```{r pubertal models}
#Remove subjects who don't have PDS Crockett values
norm_data_long_col_pds <- subset(norm_data_long_col,(!is.na(norm_data_long_col$a_pds_crockett_stage)))

#Create new dataset separated by sex
norm_data_long_col_pds_f=subset(norm_data_long_col_pds, sex_orderedfactor=="Female")
norm_data_long_col_pds_m=subset(norm_data_long_col_pds, sex_orderedfactor=="Male")
```

```{r}
#lmeControl to help with convergence 

#Parameters for gamm's
lmc <- lmeControl(maxIter = 1000, 
                   msMaxIter = 1000, 
                   niterEM = 0,## this is VERY important for gamm()! 
                   opt = 'optim') 


##FEMALES
##For RVF Values
#Create empty list to add gam() model results to check s(age)
gamm_age.f_RVF <- vector(length(fm), mode = "list")
names(gamm_age.f_RVF) <- fm
for(i in fm) {
gamm_age.f_RVF[[i]] <- gamm(volume~s(age, bs = "cs", k = 4) + hemisphere + bmi_z + S_24g_1, data = subset(norm_data_long_col_pds_f, subregion==i), random=list(subject=~1),method="ML",control=lmc)
}
#Create empty list to add gam() model results to check pds
gamm_pds.f_RVF <- vector(length(fm), mode = "list")
names(gamm_pds.f_RVF) <- fm
for(i in fm) {
gamm_pds.f_RVF[[i]] <- gamm(volume~s(a_pds_comp_1, bs = "cs", k = 4) + hemisphere + bmi_z + S_24g_1, data = subset(norm_data_long_col_pds_f, subregion==i), random=list(subject=~1),method="ML",control=lmc)
}
#Create empty list to add gam() model results to check age, pds, age-by-pds
gamm_age_pds.f_ti_RVF <- vector(length(fm), mode = "list")
names(gamm_age_pds.f_ti_RVF) <- fm
for(i in fm) {
gamm_age_pds.f_ti_RVF[[i]] <- gamm(volume~ti(age, bs = "cs", k = 4) + ti(a_pds_comp_1, bs = "cs", k = 4) + ti(age, a_pds_comp_1, k = 4) + hemisphere + bmi_z + S_24g_1, data = subset(norm_data_long_col_pds_f, subregion==i), random=list(subject=~1),method="ML",control=lmc)
}

##For RVF Values + ICV
#Create empty list to add gam() model results to check s(age)
gamm_age.f_RVFicv <- vector(length(fm), mode = "list")
names(gamm_age.f_RVFicv) <- fm
for(i in fm) {
gamm_age.f_RVFicv[[i]] <- gamm(volume~s(age, bs = "cs", k = 4) + hemisphere + bmi_z + ICV + S_24g_1, data = subset(norm_data_long_col_pds_f, subregion==i), random=list(subject=~1),method="ML",control=lmc)
}
#Create empty list to add gam() model results to check pds
gamm_pds.f_RVFicv <- vector(length(fm), mode = "list")
names(gamm_pds.f_RVFicv) <- fm
for(i in fm) {
gamm_pds.f_RVFicv[[i]] <- gamm(volume~s(a_pds_comp_1, bs = "cs", k = 4) + hemisphere + bmi_z + ICV + S_24g_1, data = subset(norm_data_long_col_pds_f, subregion==i), random=list(subject=~1),method="ML",control=lmc)
}
#Create empty list to add gam() model results to check age, pds, age-by-pds, ICV
gamm_age_pds.f_ti_RVFicv <- vector(length(fm), mode = "list")
names(gamm_age_pds.f_ti_RVFicv) <- fm
for(i in fm) {
gamm_age_pds.f_ti_RVFicv[[i]] <- gamm(volume~ti(age, bs = "cs", k = 4) + ti(a_pds_comp_1, bs = "cs", k = 4) + ti(age, a_pds_comp_1, k = 4) + hemisphere + bmi_z + ICV + S_24g_1, data = subset(norm_data_long_col_pds_f, subregion==i), random=list(subject=~1),method="ML",control=lmc)
}

##For ABS Values + ICV
#Create empty list to add gam() model results to check s(age)
gamm_age.f_ABS <- vector(length(fm_a), mode = "list")
names(gamm_age.f_ABS) <- fm_a
for(i in fm_a) {
gamm_age.f_ABS[[i]] <- gamm(volume~s(age, bs = "cs", k = 4) + hemisphere + bmi_z + ICV + S_24g_1, data = subset(norm_data_long_col_pds_f, subregion==i), random=list(subject=~1),method="ML",control=lmc)
}
#Create empty list to add gam() model results to check pds
gamm_pds.f_ABS <- vector(length(fm_a), mode = "list")
names(gamm_pds.f_ABS) <- fm_a
for(i in fm_a) {
gamm_pds.f_ABS[[i]] <- gamm(volume~s(a_pds_comp_1, bs = "cs", k = 4) + hemisphere + bmi_z + ICV + S_24g_1, data = subset(norm_data_long_col_pds_f, subregion==i), random=list(subject=~1),method="ML",control=lmc)
}
#Create empty list to add gam() model results to check age, pds, age-by-pds
gamm_age_pds.f_ti_ABS <- vector(length(fm_a), mode = "list")
names(gamm_age_pds.f_ti_ABS) <- fm_a
for(i in fm_a) {
gamm_age_pds.f_ti_ABS[[i]] <- gamm(volume~ti(age, bs = "cs", k = 4) + ti(a_pds_comp_1, bs = "cs", k = 4) + ti(age, a_pds_comp_1, k = 4) + hemisphere + bmi_z + ICV + S_24g_1, data = subset(norm_data_long_col_pds_f, subregion==i), random=list(subject=~1),method="ML",control=lmc)
}


##MALES
##For RVF Values
#Create empty list to add gam() model results to check s(age)
gamm_age.m_RVF <- vector(length(fm), mode = "list")
names(gamm_age.m_RVF) <- fm
for(i in fm) {
gamm_age.m_RVF[[i]] <- gamm(volume~s(age, bs = "cs", k = 4) + hemisphere + bmi_z + S_24g_1, data = subset(norm_data_long_col_pds_m, subregion==i), random=list(subject=~1),method="ML",control=lmc)
}
#Create empty list to add gam() model results to check pds
gamm_pds.m_RVF <- vector(length(fm), mode = "list")
names(gamm_pds.m_RVF) <- fm
for(i in fm) {
gamm_pds.m_RVF[[i]] <- gamm(volume~s(a_pds_comp_1, bs = "cs", k = 4) + hemisphere + bmi_z + S_24g_1, data = subset(norm_data_long_col_pds_m, subregion==i), random=list(subject=~1),method="ML",control=lmc)
}
#Create empty list to add gam() model results to check age, pds, age-by-pds
gamm_age_pds.m_ti_RVF <- vector(length(fm), mode = "list")
names(gamm_age_pds.m_ti_RVF) <- fm
for(i in fm) {
gamm_age_pds.m_ti_RVF[[i]] <- gamm(volume~ti(age, bs = "cs", k = 4) + ti(a_pds_comp_1, bs = "cs", k = 4) + ti(age, a_pds_comp_1, k = 4) + hemisphere + bmi_z + S_24g_1, data = subset(norm_data_long_col_pds_m, subregion==i), random=list(subject=~1),method="ML",control=lmc)
}

##For RVF Values + ICV
#Create empty list to add gam() model results to check s(age)
gamm_age.m_RVFicv <- vector(length(fm), mode = "list")
names(gamm_age.m_RVFicv) <- fm
for(i in fm) {
gamm_age.m_RVFicv[[i]] <- gamm(volume~s(age, bs = "cs", k = 4) + hemisphere + bmi_z + ICV + S_24g_1, data = subset(norm_data_long_col_pds_m, subregion==i), random=list(subject=~1),method="ML",control=lmc)
}
#Create empty list to add gam() model results to check pds
gamm_pds.m_RVFicv <- vector(length(fm), mode = "list")
names(gamm_pds.m_RVFicv) <- fm
for(i in fm) {
gamm_pds.m_RVFicv[[i]] <- gamm(volume~s(a_pds_comp_1, bs = "cs", k = 4) + hemisphere + bmi_z + ICV + S_24g_1, data = subset(norm_data_long_col_pds_m, subregion==i), random=list(subject=~1),method="ML",control=lmc)
}
#Create empty list to add gam() model results to check age, pds, age-by-pds, ICV
gamm_age_pds.m_ti_RVFicv <- vector(length(fm), mode = "list")
names(gamm_age_pds.m_ti_RVFicv) <- fm
for(i in fm) {
gamm_age_pds.m_ti_RVFicv[[i]] <- gamm(volume~ti(age, bs = "cs", k = 4) + ti(a_pds_comp_1, bs = "cs", k = 4) + ti(age, a_pds_comp_1, k = 4) + hemisphere + bmi_z + ICV + S_24g_1, data = subset(norm_data_long_col_pds_m, subregion==i), random=list(subject=~1),method="ML",control=lmc)
}

##For ABS Values + ICV
#Create empty list to add gam() model results to check s(age)
gamm_age.m_ABS <- vector(length(fm_a), mode = "list")
names(gamm_age.m_ABS) <- fm_a
for(i in fm_a) {
gamm_age.m_ABS[[i]] <- gamm(volume~s(age, bs = "cs", k = 4) + hemisphere + bmi_z + ICV + S_24g_1, data = subset(norm_data_long_col_pds_m, subregion==i), random=list(subject=~1),method="ML",control=lmc)
}
#Create empty list to add gam() model results to check pds
gamm_pds.m_ABS <- vector(length(fm_a), mode = "list")
names(gamm_pds.m_ABS) <- fm_a
for(i in fm_a) {
gamm_pds.m_ABS[[i]] <- gamm(volume~s(a_pds_comp_1, bs = "cs", k = 4) + hemisphere + bmi_z + ICV + S_24g_1, data = subset(norm_data_long_col_pds_m, subregion==i), random=list(subject=~1),method="ML",control=lmc)
}
#Create empty list to add gam() model results to check age, pds, age-by-pds
gamm_age_pds.m_ti_ABS <- vector(length(fm_a), mode = "list")
names(gamm_age_pds.m_ti_ABS) <- fm_a
for(i in fm_a) {
gamm_age_pds.m_ti_ABS[[i]] <- gamm(volume~ti(age, bs = "cs", k = 4) + ti(a_pds_comp_1, bs = "cs", k = 4) + ti(age, a_pds_comp_1, k = 4) + hemisphere + bmi_z + ICV + S_24g_1, data = subset(norm_data_long_col_pds_m, subregion==i), random=list(subject=~1),method="ML",control=lmc)
}

```


```{r}
#Export pds gamm models

##FOR FEMALES

##RVF
#Export summary values for s(age)
gamm_age.f_RVF_sum <- data.frame("","","","")
#Loop through function and export table
for(i in fm) {
  smooth_val <- data.frame(summary(gamm_age.f_RVF[[i]]$gam)$s.table)
  name_names <- data.frame("Region","Rsq Adj","N","")
  colnames(name_names) <- c("edf","Ref.df","F","p.value")
  name_val <- data.frame(i,summary(gamm_age.f_RVF[[i]]$gam)$r.sq,summary(gamm_age.f_RVF[[i]]$gam)$n,"")
  colnames(name_val) <- c("edf","Ref.df","F","p.value")
  all_val <- rbind(smooth_val, name_names, name_val)
  gamm_age.f_RVF_sum <- cbind(all_val, gamm_age.f_RVF_sum)
}
#write.csv(gamm_age.f_RVF_sum, "RVF Female - Summary gam = s(age)_1.6.20.csv")
#Export summary values for s(age)
gamm_pds.f_RVF_sum <- data.frame("","","","")
#Loop through function and export table
for(i in fm) {
  smooth_val <- data.frame(summary(gamm_pds.f_RVF[[i]]$gam)$s.table)
  name_names <- data.frame("Region","Rsq Adj","N","")
  colnames(name_names) <- c("edf","Ref.df","F","p.value")
  name_val <- data.frame(i,summary(gamm_pds.f_RVF[[i]]$gam)$r.sq,summary(gamm_pds.f_RVF[[i]]$gam)$n,"")
  colnames(name_val) <- c("edf","Ref.df","F","p.value")
  all_val <- rbind(smooth_val, name_names, name_val)
  gamm_pds.f_RVF_sum <- cbind(all_val, gamm_pds.f_RVF_sum)
}
#write.csv(gamm_pds.f_RVF_sum, "RVF Female - Summary gam = s(pds)_1.6.20.csv")
#Export summary values for ti(age)+ti(pds)+ti(age,pds)
gamm_age_pds.f_ti_RVF_sum <- data.frame("","","","")
#Loop through function and export table
for(i in fm) {
  smooth_val <- data.frame(summary(gamm_age_pds.f_ti_RVF[[i]]$gam)$s.table)
  name_names <- data.frame("Region","Rsq Adj","N","")
  colnames(name_names) <- c("edf","Ref.df","F","p.value")
  name_val <- data.frame(i,summary(gamm_age_pds.f_ti_RVF[[i]]$gam)$r.sq,summary(gamm_age_pds.f_ti_RVF[[i]]$gam)$n,"")
  colnames(name_val) <- c("edf","Ref.df","F","p.value")
  all_val <- rbind(smooth_val, name_names, name_val)
  gamm_age_pds.f_ti_RVF_sum <- cbind(all_val, gamm_age_pds.f_ti_RVF_sum)
}
#write.csv(gamm_age_pds.f_ti_RVF_sum, "RVF Female - Summary gam = ti(age)+ti(pds)+ti(age,pds)_1.6.20.csv")

##RVFicv
#Export summary values for s(age)
gamm_age.f_RVFicv_sum <- data.frame("","","","")
#Loop through function and export table
for(i in fm) {
  smooth_val <- data.frame(summary(gamm_age.f_RVFicv[[i]]$gam)$s.table)
  name_names <- data.frame("Region","Rsq Adj","N","")
  colnames(name_names) <- c("edf","Ref.df","F","p.value")
  name_val <- data.frame(i,summary(gamm_age.f_RVFicv[[i]]$gam)$r.sq,summary(gamm_age.f_RVFicv[[i]]$gam)$n,"")
  colnames(name_val) <- c("edf","Ref.df","F","p.value")
  all_val <- rbind(smooth_val, name_names, name_val)
  gamm_age.f_RVFicv_sum <- cbind(all_val, gamm_age.f_RVFicv_sum)
}
#write.csv(gamm_age.f_RVFicv_sum, "RVFicv Female - Summary gam = s(age)_1.6.20.csv")
#Export summary values for s(age)
gamm_pds.f_RVFicv_sum <- data.frame("","","","")
#Loop through function and export table
for(i in fm) {
  smooth_val <- data.frame(summary(gamm_pds.f_RVFicv[[i]]$gam)$s.table)
  name_names <- data.frame("Region","Rsq Adj","N","")
  colnames(name_names) <- c("edf","Ref.df","F","p.value")
  name_val <- data.frame(i,summary(gamm_pds.f_RVFicv[[i]]$gam)$r.sq,summary(gamm_pds.f_RVFicv[[i]]$gam)$n,"")
  colnames(name_val) <- c("edf","Ref.df","F","p.value")
  all_val <- rbind(smooth_val, name_names, name_val)
  gamm_pds.f_RVFicv_sum <- cbind(all_val, gamm_pds.f_RVFicv_sum)
}
#write.csv(gamm_pds.f_RVFicv_sum, "RVFicv Female - Summary gam = s(pds)_1.6.20.csv")
#Export summary values for ti(age)+ti(pds)+ti(age,pds)
gamm_age_pds.f_ti_RVFicv_sum <- data.frame("","","","")
#Loop through function and export table
for(i in fm) {
  smooth_val <- data.frame(summary(gamm_age_pds.f_ti_RVFicv[[i]]$gam)$s.table)
  name_names <- data.frame("Region","Rsq Adj","N","")
  colnames(name_names) <- c("edf","Ref.df","F","p.value")
  name_val <- data.frame(i,summary(gamm_age_pds.f_ti_RVFicv[[i]]$gam)$r.sq,summary(gamm_age_pds.f_ti_RVFicv[[i]]$gam)$n,"")
  colnames(name_val) <- c("edf","Ref.df","F","p.value")
  all_val <- rbind(smooth_val, name_names, name_val)
  gamm_age_pds.f_ti_RVFicv_sum <- cbind(all_val, gamm_age_pds.f_ti_RVFicv_sum)
}
#write.csv(gamm_age_pds.f_ti_RVFicv_sum, "RVFicv Female - Summary gam = ti(age)+ti(pds)+ti(age,pds)_1.6.20.csv")

##ABS
#Export summary values for s(age)
gamm_age.f_ABS_sum <- data.frame("","","","")
#Loop through function and export table
for(i in fm_a) {
  smooth_val <- data.frame(summary(gamm_age.f_ABS[[i]]$gam)$s.table)
  name_names <- data.frame("Region","Rsq Adj","N","")
  colnames(name_names) <- c("edf","Ref.df","F","p.value")
  name_val <- data.frame(i,summary(gamm_age.f_ABS[[i]]$gam)$r.sq,summary(gamm_age.f_ABS[[i]]$gam)$n,"")
  colnames(name_val) <- c("edf","Ref.df","F","p.value")
  all_val <- rbind(smooth_val, name_names, name_val)
  gamm_age.f_ABS_sum <- cbind(all_val, gamm_age.f_ABS_sum)
}
#write.csv(gamm_age.f_ABS_sum, "ABS Female - Summary gam = s(age)_1.6.20.csv")
#Export summary values for s(age)
gamm_pds.f_ABS_sum <- data.frame("","","","")
#Loop through function and export table
for(i in fm_a) {
  smooth_val <- data.frame(summary(gamm_pds.f_ABS[[i]]$gam)$s.table)
  name_names <- data.frame("Region","Rsq Adj","N","")
  colnames(name_names) <- c("edf","Ref.df","F","p.value")
  name_val <- data.frame(i,summary(gamm_pds.f_ABS[[i]]$gam)$r.sq,summary(gamm_pds.f_ABS[[i]]$gam)$n,"")
  colnames(name_val) <- c("edf","Ref.df","F","p.value")
  all_val <- rbind(smooth_val, name_names, name_val)
  gamm_pds.f_ABS_sum <- cbind(all_val, gamm_pds.f_ABS_sum)
}
#write.csv(gamm_pds.f_ABS_sum, "ABS Female - Summary gam = s(pds)_1.6.20.csv")
#Export summary values for ti(age)+ti(pds)+ti(age,pds)
gamm_age_pds.f_ti_ABS_sum <- data.frame("","","","")
#Loop through function and export table
for(i in fm_a) {
  smooth_val <- data.frame(summary(gamm_age_pds.f_ti_ABS[[i]]$gam)$s.table)
  name_names <- data.frame("Region","Rsq Adj","N","")
  colnames(name_names) <- c("edf","Ref.df","F","p.value")
  name_val <- data.frame(i,summary(gamm_age_pds.f_ti_ABS[[i]]$gam)$r.sq,summary(gamm_age_pds.f_ti_ABS[[i]]$gam)$n,"")
  colnames(name_val) <- c("edf","Ref.df","F","p.value")
  all_val <- rbind(smooth_val, name_names, name_val)
  gamm_age_pds.f_ti_ABS_sum <- cbind(all_val, gamm_age_pds.f_ti_ABS_sum)
}
#write.csv(gamm_age_pds.f_ti_ABS_sum, "ABS Female - Summary gam = ti(age)+ti(pds)+ti(age,pds)_1.6.20.csv")


##FOR MALES
##RVF
#Export summary values for s(age)
gamm_age.m_RVF_sum <- data.frame("","","","")
#Loop through function and export table
for(i in fm) {
  smooth_val <- data.frame(summary(gamm_age.m_RVF[[i]]$gam)$s.table)
  name_names <- data.frame("Region","Rsq Adj","N","")
  colnames(name_names) <- c("edf","Ref.df","F","p.value")
  name_val <- data.frame(i,summary(gamm_age.m_RVF[[i]]$gam)$r.sq,summary(gamm_age.m_RVF[[i]]$gam)$n,"")
  colnames(name_val) <- c("edf","Ref.df","F","p.value")
  all_val <- rbind(smooth_val, name_names, name_val)
  gamm_age.m_RVF_sum <- cbind(all_val, gamm_age.m_RVF_sum)
}
#write.csv(gamm_age.m_RVF_sum, "RVF Male - Summary gam = s(age)_1.6.20.csv")
#Export summary values for s(age)
gamm_pds.m_RVF_sum <- data.frame("","","","")
#Loop through function and export table
for(i in fm) {
  smooth_val <- data.frame(summary(gamm_pds.m_RVF[[i]]$gam)$s.table)
  name_names <- data.frame("Region","Rsq Adj","N","")
  colnames(name_names) <- c("edf","Ref.df","F","p.value")
  name_val <- data.frame(i,summary(gamm_pds.m_RVF[[i]]$gam)$r.sq,summary(gamm_pds.m_RVF[[i]]$gam)$n,"")
  colnames(name_val) <- c("edf","Ref.df","F","p.value")
  all_val <- rbind(smooth_val, name_names, name_val)
  gamm_pds.m_RVF_sum <- cbind(all_val, gamm_pds.m_RVF_sum)
}
#write.csv(gamm_pds.m_RVF_sum, "RVF Male - Summary gam = s(pds)_1.6.20.csv")
#Export summary values for ti(age)+ti(pds)+ti(age,pds)
gamm_age_pds.m_ti_RVF_sum <- data.frame("","","","")
#Loop through function and export table
for(i in fm) {
  smooth_val <- data.frame(summary(gamm_age_pds.m_ti_RVF[[i]]$gam)$s.table)
  name_names <- data.frame("Region","Rsq Adj","N","")
  colnames(name_names) <- c("edf","Ref.df","F","p.value")
  name_val <- data.frame(i,summary(gamm_age_pds.m_ti_RVF[[i]]$gam)$r.sq,summary(gamm_age_pds.m_ti_RVF[[i]]$gam)$n,"")
  colnames(name_val) <- c("edf","Ref.df","F","p.value")
  all_val <- rbind(smooth_val, name_names, name_val)
  gamm_age_pds.m_ti_RVF_sum <- cbind(all_val, gamm_age_pds.m_ti_RVF_sum)
}
#write.csv(gamm_age_pds.m_ti_RVF_sum, "RVF Male - Summary gam = ti(age)+ti(pds)+ti(age,pds)_1.6.20.csv")

##RVFicv
#Export summary values for s(age)
gamm_age.m_RVFicv_sum <- data.frame("","","","")
#Loop through function and export table
for(i in fm) {
  smooth_val <- data.frame(summary(gamm_age.m_RVFicv[[i]]$gam)$s.table)
  name_names <- data.frame("Region","Rsq Adj","N","")
  colnames(name_names) <- c("edf","Ref.df","F","p.value")
  name_val <- data.frame(i,summary(gamm_age.m_RVFicv[[i]]$gam)$r.sq,summary(gamm_age.m_RVFicv[[i]]$gam)$n,"")
  colnames(name_val) <- c("edf","Ref.df","F","p.value")
  all_val <- rbind(smooth_val, name_names, name_val)
  gamm_age.m_RVFicv_sum <- cbind(all_val, gamm_age.m_RVFicv_sum)
}
#write.csv(gamm_age.m_RVFicv_sum, "RVFicv Male - Summary gam = s(age)_1.6.20.csv")
#Export summary values for s(age)
gamm_pds.m_RVFicv_sum <- data.frame("","","","")
#Loop through function and export table
for(i in fm) {
  smooth_val <- data.frame(summary(gamm_pds.m_RVFicv[[i]]$gam)$s.table)
  name_names <- data.frame("Region","Rsq Adj","N","")
  colnames(name_names) <- c("edf","Ref.df","F","p.value")
  name_val <- data.frame(i,summary(gamm_pds.m_RVFicv[[i]]$gam)$r.sq,summary(gamm_pds.m_RVFicv[[i]]$gam)$n,"")
  colnames(name_val) <- c("edf","Ref.df","F","p.value")
  all_val <- rbind(smooth_val, name_names, name_val)
  gamm_pds.m_RVFicv_sum <- cbind(all_val, gamm_pds.m_RVFicv_sum)
}
#write.csv(gamm_pds.m_RVFicv_sum, "RVFicv Male - Summary gam = s(pds)_1.6.20.csv")
#Export summary values for ti(age)+ti(pds)+ti(age,pds)
gamm_age_pds.m_ti_RVFicv_sum <- data.frame("","","","")
#Loop through function and export table
for(i in fm) {
  smooth_val <- data.frame(summary(gamm_age_pds.m_ti_RVFicv[[i]]$gam)$s.table)
  name_names <- data.frame("Region","Rsq Adj","N","")
  colnames(name_names) <- c("edf","Ref.df","F","p.value")
  name_val <- data.frame(i,summary(gamm_age_pds.m_ti_RVFicv[[i]]$gam)$r.sq,summary(gamm_age_pds.m_ti_RVFicv[[i]]$gam)$n,"")
  colnames(name_val) <- c("edf","Ref.df","F","p.value")
  all_val <- rbind(smooth_val, name_names, name_val)
  gamm_age_pds.m_ti_RVFicv_sum <- cbind(all_val, gamm_age_pds.m_ti_RVFicv_sum)
}
#write.csv(gamm_age_pds.m_ti_RVFicv_sum, "RVFicv Male - Summary gam = ti(age)+ti(pds)+ti(age,pds)_1.6.20.csv")

##ABS
#Export summary values for s(age)
gamm_age.m_ABS_sum <- data.frame("","","","")
#Loop through function and export table
for(i in fm_a) {
  smooth_val <- data.frame(summary(gamm_age.m_ABS[[i]]$gam)$s.table)
  name_names <- data.frame("Region","Rsq Adj","N","")
  colnames(name_names) <- c("edf","Ref.df","F","p.value")
  name_val <- data.frame(i,summary(gamm_age.m_ABS[[i]]$gam)$r.sq,summary(gamm_age.m_ABS[[i]]$gam)$n,"")
  colnames(name_val) <- c("edf","Ref.df","F","p.value")
  all_val <- rbind(smooth_val, name_names, name_val)
  gamm_age.m_ABS_sum <- cbind(all_val, gamm_age.m_ABS_sum)
}
#write.csv(gamm_age.m_ABS_sum, "ABS Male - Summary gam = s(age)_1.6.20.csv")
#Export summary values for s(age)
gamm_pds.m_ABS_sum <- data.frame("","","","")
#Loop through function and export table
for(i in fm_a) {
  smooth_val <- data.frame(summary(gamm_pds.m_ABS[[i]]$gam)$s.table)
  name_names <- data.frame("Region","Rsq Adj","N","")
  colnames(name_names) <- c("edf","Ref.df","F","p.value")
  name_val <- data.frame(i,summary(gamm_pds.m_ABS[[i]]$gam)$r.sq,summary(gamm_pds.m_ABS[[i]]$gam)$n,"")
  colnames(name_val) <- c("edf","Ref.df","F","p.value")
  all_val <- rbind(smooth_val, name_names, name_val)
  gamm_pds.m_ABS_sum <- cbind(all_val, gamm_pds.m_ABS_sum)
}
#write.csv(gamm_pds.m_ABS_sum, "ABS Male - Summary gam = s(pds)_1.6.20.csv")
#Export summary values for ti(age)+ti(pds)+ti(age,pds)
gamm_age_pds.m_ti_ABS_sum <- data.frame("","","","")
#Loop through function and export table
for(i in fm_a) {
  smooth_val <- data.frame(summary(gamm_age_pds.m_ti_ABS[[i]]$gam)$s.table)
  name_names <- data.frame("Region","Rsq Adj","N","")
  colnames(name_names) <- c("edf","Ref.df","F","p.value")
  name_val <- data.frame(i,summary(gamm_age_pds.m_ti_ABS[[i]]$gam)$r.sq,summary(gamm_age_pds.m_ti_ABS[[i]]$gam)$n,"")
  colnames(name_val) <- c("edf","Ref.df","F","p.value")
  all_val <- rbind(smooth_val, name_names, name_val)
  gamm_age_pds.m_ti_ABS_sum <- cbind(all_val, gamm_age_pds.m_ti_ABS_sum)
}
#write.csv(gamm_age_pds.m_ti_ABS_sum, "ABS Male - Summary gam = ti(age)+ti(pds)+ti(age,pds)_1.6.20.csv")
```


```{r pubertal anova comparisons}
#Compare models

##FEMALES
##RVF
###s(age) vs. ti(age, by:pds)
age_age.pds_LA.f_RVF <- anova(gamm_age.f_RVF[["LA"]]$lme, gamm_age_pds.f_ti_RVF[["LA"]]$lme)
age_age.pds_BLDI.f_RVF <- anova(gamm_age.f_RVF[["BLDI"]]$lme, gamm_age_pds.f_ti_RVF[["BLDI"]]$lme)
age_age.pds_BLVPL.f_RVF <- anova(gamm_age.f_RVF[["BLVPL"]]$lme, gamm_age_pds.f_ti_RVF[["BLVPL"]]$lme)
age_age.pds_BM.f_RVF <- anova(gamm_age.f_RVF[["BM"]]$lme, gamm_age_pds.f_ti_RVF[["BM"]]$lme)
age_age.pds_CMN.f_RVF <- anova(gamm_age.f_RVF[["CMN"]]$lme, gamm_age_pds.f_ti_RVF[["CMN"]]$lme)
age_age.pds_CEN.f_RVF <- anova(gamm_age.f_RVF[["CEN"]]$lme, gamm_age_pds.f_ti_RVF[["CEN"]]$lme)
age_age.pds_AAA.f_RVF <- anova(gamm_age.f_RVF[["AAA"]]$lme, gamm_age_pds.f_ti_RVF[["AAA"]]$lme)
age_age.pds_ATA.f_RVF <- anova(gamm_age.f_RVF[["ATA"]]$lme, gamm_age_pds.f_ti_RVF[["ATA"]]$lme)
age_age.pds_ASTA.f_RVF <- anova(gamm_age.f_RVF[["ASTA"]]$lme, gamm_age_pds.f_ti_RVF[["ASTA"]]$lme)
#bind all anova's above to export
age_age.pds_anova.f_RVF <- rbind(age_age.pds_LA.f_RVF,age_age.pds_BLDI.f_RVF,age_age.pds_BLVPL.f_RVF,age_age.pds_BM.f_RVF,age_age.pds_CMN.f_RVF,age_age.pds_CEN.f_RVF,age_age.pds_AAA.f_RVF,age_age.pds_ATA.f_RVF,age_age.pds_ASTA.f_RVF)
#write anova df to file
#write.csv(age_age.pds_anova.f_RVF, "RVF Female - Anova's for age vs age-by-pds_1.6.20.csv")
###s(pds) vs. ti(age, by:pds) only
pds_age.pds_LA.f_RVF <- anova(gamm_pds.f_RVF[["LA"]]$lme, gamm_age_pds.f_ti_RVF[["LA"]]$lme)
pds_age.pds_BLDI.f_RVF <- anova(gamm_pds.f_RVF[["BLDI"]]$lme, gamm_age_pds.f_ti_RVF[["BLDI"]]$lme)
pds_age.pds_BLVPL.f_RVF <- anova(gamm_pds.f_RVF[["BLVPL"]]$lme, gamm_age_pds.f_ti_RVF[["BLVPL"]]$lme)
pds_age.pds_BM.f_RVF <- anova(gamm_pds.f_RVF[["BM"]]$lme, gamm_age_pds.f_ti_RVF[["BM"]]$lme)
pds_age.pds_CMN.f_RVF <- anova(gamm_pds.f_RVF[["CMN"]]$lme, gamm_age_pds.f_ti_RVF[["CMN"]]$lme)
pds_age.pds_CEN.f_RVF <- anova(gamm_pds.f_RVF[["CEN"]]$lme, gamm_age_pds.f_ti_RVF[["CEN"]]$lme)
pds_age.pds_AAA.f_RVF <- anova(gamm_pds.f_RVF[["AAA"]]$lme, gamm_age_pds.f_ti_RVF[["AAA"]]$lme)
pds_age.pds_ATA.f_RVF <- anova(gamm_pds.f_RVF[["ATA"]]$lme, gamm_age_pds.f_ti_RVF[["ATA"]]$lme)
pds_age.pds_ASTA.f_RVF <- anova(gamm_pds.f_RVF[["ASTA"]]$lme, gamm_age_pds.f_ti_RVF[["ASTA"]]$lme)
#bind all anova's above to export
pds_age.pds_anova.f_RVF <- rbind(pds_age.pds_LA.f_RVF,pds_age.pds_BLDI.f_RVF,pds_age.pds_BLVPL.f_RVF,pds_age.pds_BM.f_RVF,pds_age.pds_CMN.f_RVF,pds_age.pds_CEN.f_RVF,pds_age.pds_AAA.f_RVF,pds_age.pds_ATA.f_RVF,pds_age.pds_ASTA.f_RVF)
#write anova df to file
#write.csv(pds_age.pds_anova.f_RVF, "RVF Female - Anova's for pds vs age-by-pds_1.6.20.csv")

##RVFicv
###s(age) vs. ti(age, by:pds)
age_age.pds_LA.f_RVFicv <- anova(gamm_age.f_RVFicv[["LA"]]$lme, gamm_age_pds.f_ti_RVFicv[["LA"]]$lme)
age_age.pds_BLDI.f_RVFicv <- anova(gamm_age.f_RVFicv[["BLDI"]]$lme, gamm_age_pds.f_ti_RVFicv[["BLDI"]]$lme)
age_age.pds_BLVPL.f_RVFicv <- anova(gamm_age.f_RVFicv[["BLVPL"]]$lme, gamm_age_pds.f_ti_RVFicv[["BLVPL"]]$lme)
age_age.pds_BM.f_RVFicv <- anova(gamm_age.f_RVFicv[["BM"]]$lme, gamm_age_pds.f_ti_RVFicv[["BM"]]$lme)
age_age.pds_CMN.f_RVFicv <- anova(gamm_age.f_RVFicv[["CMN"]]$lme, gamm_age_pds.f_ti_RVFicv[["CMN"]]$lme)
age_age.pds_CEN.f_RVFicv <- anova(gamm_age.f_RVFicv[["CEN"]]$lme, gamm_age_pds.f_ti_RVFicv[["CEN"]]$lme)
age_age.pds_AAA.f_RVFicv <- anova(gamm_age.f_RVFicv[["AAA"]]$lme, gamm_age_pds.f_ti_RVFicv[["AAA"]]$lme)
age_age.pds_ATA.f_RVFicv <- anova(gamm_age.f_RVFicv[["ATA"]]$lme, gamm_age_pds.f_ti_RVFicv[["ATA"]]$lme)
age_age.pds_ASTA.f_RVFicv <- anova(gamm_age.f_RVFicv[["ASTA"]]$lme, gamm_age_pds.f_ti_RVFicv[["ASTA"]]$lme)
#bind all anova's above to export
age_age.pds_anova.f_RVFicv <- rbind(age_age.pds_LA.f_RVFicv,age_age.pds_BLDI.f_RVFicv,age_age.pds_BLVPL.f_RVFicv,age_age.pds_BM.f_RVFicv,age_age.pds_CMN.f_RVFicv,age_age.pds_CEN.f_RVFicv,age_age.pds_AAA.f_RVFicv,age_age.pds_ATA.f_RVFicv,age_age.pds_ASTA.f_RVFicv)
#write anova df to file
#write.csv(age_age.pds_anova.f_RVFicv, "RVFicv Female - Anova's for age vs age-by-pds_1.6.20.csv")
###s(pds) vs. ti(age, by:pds) only
pds_age.pds_LA.f_RVFicv <- anova(gamm_pds.f_RVFicv[["LA"]]$lme, gamm_age_pds.f_ti_RVFicv[["LA"]]$lme)
pds_age.pds_BLDI.f_RVFicv <- anova(gamm_pds.f_RVFicv[["BLDI"]]$lme, gamm_age_pds.f_ti_RVFicv[["BLDI"]]$lme)
pds_age.pds_BLVPL.f_RVFicv <- anova(gamm_pds.f_RVFicv[["BLVPL"]]$lme, gamm_age_pds.f_ti_RVFicv[["BLVPL"]]$lme)
pds_age.pds_BM.f_RVFicv <- anova(gamm_pds.f_RVFicv[["BM"]]$lme, gamm_age_pds.f_ti_RVFicv[["BM"]]$lme)
pds_age.pds_CMN.f_RVFicv <- anova(gamm_pds.f_RVFicv[["CMN"]]$lme, gamm_age_pds.f_ti_RVFicv[["CMN"]]$lme)
pds_age.pds_CEN.f_RVFicv <- anova(gamm_pds.f_RVFicv[["CEN"]]$lme, gamm_age_pds.f_ti_RVFicv[["CEN"]]$lme)
pds_age.pds_AAA.f_RVFicv <- anova(gamm_pds.f_RVFicv[["AAA"]]$lme, gamm_age_pds.f_ti_RVFicv[["AAA"]]$lme)
pds_age.pds_ATA.f_RVFicv <- anova(gamm_pds.f_RVFicv[["ATA"]]$lme, gamm_age_pds.f_ti_RVFicv[["ATA"]]$lme)
pds_age.pds_ASTA.f_RVFicv <- anova(gamm_pds.f_RVFicv[["ASTA"]]$lme, gamm_age_pds.f_ti_RVFicv[["ASTA"]]$lme)
#bind all anova's above to export
pds_age.pds_anova.f_RVFicv <- rbind(pds_age.pds_LA.f_RVFicv,pds_age.pds_BLDI.f_RVFicv,pds_age.pds_BLVPL.f_RVFicv,pds_age.pds_BM.f_RVFicv,pds_age.pds_CMN.f_RVFicv,pds_age.pds_CEN.f_RVFicv,pds_age.pds_AAA.f_RVFicv,pds_age.pds_ATA.f_RVFicv,pds_age.pds_ASTA.f_RVFicv)
#write anova df to file
#write.csv(pds_age.pds_anova.f_RVFicv, "RVFicv Female - Anova's for pds vs age-by-pds_1.6.20.csv")

##ABS
###s(age) vs. ti(age, by:pds)
age_age.pds_Total.f_ABS <- anova(gamm_age.f_ABS[["Abs_Total"]]$lme, gamm_age_pds.f_ti_ABS[["Abs_Total"]]$lme)
age_age.pds_LA.f_ABS <- anova(gamm_age.f_ABS[["Abs_LA"]]$lme, gamm_age_pds.f_ti_ABS[["Abs_LA"]]$lme)
age_age.pds_BLDI.f_ABS <- anova(gamm_age.f_ABS[["Abs_BLDI"]]$lme, gamm_age_pds.f_ti_ABS[["Abs_BLDI"]]$lme)
age_age.pds_BLVPL.f_ABS <- anova(gamm_age.f_ABS[["Abs_BLVPL"]]$lme, gamm_age_pds.f_ti_ABS[["Abs_BLVPL"]]$lme)
age_age.pds_BM.f_ABS <- anova(gamm_age.f_ABS[["Abs_BM"]]$lme, gamm_age_pds.f_ti_ABS[["Abs_BM"]]$lme)
age_age.pds_CMN.f_ABS <- anova(gamm_age.f_ABS[["Abs_CMN"]]$lme, gamm_age_pds.f_ti_ABS[["Abs_CMN"]]$lme)
age_age.pds_CEN.f_ABS <- anova(gamm_age.f_ABS[["Abs_CEN"]]$lme, gamm_age_pds.f_ti_ABS[["Abs_CEN"]]$lme)
age_age.pds_AAA.f_ABS <- anova(gamm_age.f_ABS[["Abs_AAA"]]$lme, gamm_age_pds.f_ti_ABS[["Abs_AAA"]]$lme)
age_age.pds_ATA.f_ABS <- anova(gamm_age.f_ABS[["Abs_ATA"]]$lme, gamm_age_pds.f_ti_ABS[["Abs_ATA"]]$lme)
age_age.pds_ASTA.f_ABS <- anova(gamm_age.f_ABS[["Abs_ASTA"]]$lme, gamm_age_pds.f_ti_ABS[["Abs_ASTA"]]$lme)
#bind all anova's above to export
age_age.pds_anova.f_ABS <- rbind(age_age.pds_Total.f_ABS,age_age.pds_LA.f_ABS,age_age.pds_BLDI.f_ABS,age_age.pds_BLVPL.f_ABS,age_age.pds_BM.f_ABS,age_age.pds_CMN.f_ABS,age_age.pds_CEN.f_ABS,age_age.pds_AAA.f_ABS,age_age.pds_ATA.f_ABS,age_age.pds_ASTA.f_ABS)
#write anova df to file
#write.csv(age_age.pds_anova.f_ABS, "ABS Female - Anova's for age vs age-by-pds_1.6.20.csv")
###s(pds) vs. ti(age, by:pds) only
pds_age.pds_Total.f_ABS <- anova(gamm_pds.f_ABS[["Abs_Total"]]$lme, gamm_age_pds.f_ti_ABS[["Abs_Total"]]$lme)
pds_age.pds_LA.f_ABS <- anova(gamm_pds.f_ABS[["Abs_LA"]]$lme, gamm_age_pds.f_ti_ABS[["Abs_LA"]]$lme)
pds_age.pds_BLDI.f_ABS <- anova(gamm_pds.f_ABS[["Abs_BLDI"]]$lme, gamm_age_pds.f_ti_ABS[["Abs_BLDI"]]$lme)
pds_age.pds_BLVPL.f_ABS <- anova(gamm_pds.f_ABS[["Abs_BLVPL"]]$lme, gamm_age_pds.f_ti_ABS[["Abs_BLVPL"]]$lme)
pds_age.pds_BM.f_ABS <- anova(gamm_pds.f_ABS[["Abs_BM"]]$lme, gamm_age_pds.f_ti_ABS[["Abs_BM"]]$lme)
pds_age.pds_CMN.f_ABS <- anova(gamm_pds.f_ABS[["Abs_CMN"]]$lme, gamm_age_pds.f_ti_ABS[["Abs_CMN"]]$lme)
pds_age.pds_CEN.f_ABS <- anova(gamm_pds.f_ABS[["Abs_CEN"]]$lme, gamm_age_pds.f_ti_ABS[["Abs_CEN"]]$lme)
pds_age.pds_AAA.f_ABS <- anova(gamm_pds.f_ABS[["Abs_AAA"]]$lme, gamm_age_pds.f_ti_ABS[["Abs_AAA"]]$lme)
pds_age.pds_ATA.f_ABS <- anova(gamm_pds.f_ABS[["Abs_ATA"]]$lme, gamm_age_pds.f_ti_ABS[["Abs_ATA"]]$lme)
pds_age.pds_ASTA.f_ABS <- anova(gamm_pds.f_ABS[["Abs_ASTA"]]$lme, gamm_age_pds.f_ti_ABS[["Abs_ASTA"]]$lme)
#bind all anova's above to export
pds_age.pds_anova.f_ABS <- rbind(pds_age.pds_Total.f_ABS,pds_age.pds_LA.f_ABS,pds_age.pds_BLDI.f_ABS,pds_age.pds_BLVPL.f_ABS,pds_age.pds_BM.f_ABS,pds_age.pds_CMN.f_ABS,pds_age.pds_CEN.f_ABS,pds_age.pds_AAA.f_ABS,pds_age.pds_ATA.f_ABS,pds_age.pds_ASTA.f_ABS)
#write anova df to file
#write.csv(pds_age.pds_anova.f_ABS, "ABS Female - Anova's for pds vs age-by-pds_1.6.20.csv")


##MALES
##RVF
###s(age) vs. ti(age, by:pds)
age_age.pds_LA.m_RVF <- anova(gamm_age.m_RVF[["LA"]]$lme, gamm_age_pds.m_ti_RVF[["LA"]]$lme)
age_age.pds_BLDI.m_RVF <- anova(gamm_age.m_RVF[["BLDI"]]$lme, gamm_age_pds.m_ti_RVF[["BLDI"]]$lme)
age_age.pds_BLVPL.m_RVF <- anova(gamm_age.m_RVF[["BLVPL"]]$lme, gamm_age_pds.m_ti_RVF[["BLVPL"]]$lme)
age_age.pds_BM.m_RVF <- anova(gamm_age.m_RVF[["BM"]]$lme, gamm_age_pds.m_ti_RVF[["BM"]]$lme)
age_age.pds_CMN.m_RVF <- anova(gamm_age.m_RVF[["CMN"]]$lme, gamm_age_pds.m_ti_RVF[["CMN"]]$lme)
age_age.pds_CEN.m_RVF <- anova(gamm_age.m_RVF[["CEN"]]$lme, gamm_age_pds.m_ti_RVF[["CEN"]]$lme)
age_age.pds_AAA.m_RVF <- anova(gamm_age.m_RVF[["AAA"]]$lme, gamm_age_pds.m_ti_RVF[["AAA"]]$lme)
age_age.pds_ATA.m_RVF <- anova(gamm_age.m_RVF[["ATA"]]$lme, gamm_age_pds.m_ti_RVF[["ATA"]]$lme)
age_age.pds_ASTA.m_RVF <- anova(gamm_age.m_RVF[["ASTA"]]$lme, gamm_age_pds.m_ti_RVF[["ASTA"]]$lme)
#bind all anova's above to export
age_age.pds_anova.m_RVF <- rbind(age_age.pds_LA.m_RVF,age_age.pds_BLDI.m_RVF,age_age.pds_BLVPL.m_RVF,age_age.pds_BM.m_RVF,age_age.pds_CMN.m_RVF,age_age.pds_CEN.m_RVF,age_age.pds_AAA.m_RVF,age_age.pds_ATA.m_RVF,age_age.pds_ASTA.m_RVF)
#write anova df to file
#write.csv(age_age.pds_anova.m_RVF, "RVF Male - Anova's for age vs age-by-pds_1.6.20.csv")
###s(pds) vs. ti(age, by:pds) only
pds_age.pds_LA.m_RVF <- anova(gamm_pds.m_RVF[["LA"]]$lme, gamm_age_pds.m_ti_RVF[["LA"]]$lme)
pds_age.pds_BLDI.m_RVF <- anova(gamm_pds.m_RVF[["BLDI"]]$lme, gamm_age_pds.m_ti_RVF[["BLDI"]]$lme)
pds_age.pds_BLVPL.m_RVF <- anova(gamm_pds.m_RVF[["BLVPL"]]$lme, gamm_age_pds.m_ti_RVF[["BLVPL"]]$lme)
pds_age.pds_BM.m_RVF <- anova(gamm_pds.m_RVF[["BM"]]$lme, gamm_age_pds.m_ti_RVF[["BM"]]$lme)
pds_age.pds_CMN.m_RVF <- anova(gamm_pds.m_RVF[["CMN"]]$lme, gamm_age_pds.m_ti_RVF[["CMN"]]$lme)
pds_age.pds_CEN.m_RVF <- anova(gamm_pds.m_RVF[["CEN"]]$lme, gamm_age_pds.m_ti_RVF[["CEN"]]$lme)
pds_age.pds_AAA.m_RVF <- anova(gamm_pds.m_RVF[["AAA"]]$lme, gamm_age_pds.m_ti_RVF[["AAA"]]$lme)
pds_age.pds_ATA.m_RVF <- anova(gamm_pds.m_RVF[["ATA"]]$lme, gamm_age_pds.m_ti_RVF[["ATA"]]$lme)
pds_age.pds_ASTA.m_RVF <- anova(gamm_pds.m_RVF[["ASTA"]]$lme, gamm_age_pds.m_ti_RVF[["ASTA"]]$lme)
#bind all anova's above to export
pds_age.pds_anova.m_RVF <- rbind(pds_age.pds_LA.m_RVF,pds_age.pds_BLDI.m_RVF,pds_age.pds_BLVPL.m_RVF,pds_age.pds_BM.m_RVF,pds_age.pds_CMN.m_RVF,pds_age.pds_CEN.m_RVF,pds_age.pds_AAA.m_RVF,pds_age.pds_ATA.m_RVF,pds_age.pds_ASTA.m_RVF)
#write anova df to file
#write.csv(pds_age.pds_anova.m_RVF, "RVF Male - Anova's for pds vs age-by-pds_1.6.20.csv")

##RVFicv
###s(age) vs. ti(age, by:pds)
age_age.pds_LA.m_RVFicv <- anova(gamm_age.m_RVFicv[["LA"]]$lme, gamm_age_pds.m_ti_RVFicv[["LA"]]$lme)
age_age.pds_BLDI.m_RVFicv <- anova(gamm_age.m_RVFicv[["BLDI"]]$lme, gamm_age_pds.m_ti_RVFicv[["BLDI"]]$lme)
age_age.pds_BLVPL.m_RVFicv <- anova(gamm_age.m_RVFicv[["BLVPL"]]$lme, gamm_age_pds.m_ti_RVFicv[["BLVPL"]]$lme)
age_age.pds_BM.m_RVFicv <- anova(gamm_age.m_RVFicv[["BM"]]$lme, gamm_age_pds.m_ti_RVFicv[["BM"]]$lme)
age_age.pds_CMN.m_RVFicv <- anova(gamm_age.m_RVFicv[["CMN"]]$lme, gamm_age_pds.m_ti_RVFicv[["CMN"]]$lme)
age_age.pds_CEN.m_RVFicv <- anova(gamm_age.m_RVFicv[["CEN"]]$lme, gamm_age_pds.m_ti_RVFicv[["CEN"]]$lme)
age_age.pds_AAA.m_RVFicv <- anova(gamm_age.m_RVFicv[["AAA"]]$lme, gamm_age_pds.m_ti_RVFicv[["AAA"]]$lme)
age_age.pds_ATA.m_RVFicv <- anova(gamm_age.m_RVFicv[["ATA"]]$lme, gamm_age_pds.m_ti_RVFicv[["ATA"]]$lme)
age_age.pds_ASTA.m_RVFicv <- anova(gamm_age.m_RVFicv[["ASTA"]]$lme, gamm_age_pds.m_ti_RVFicv[["ASTA"]]$lme)
#bind all anova's above to export
age_age.pds_anova.m_RVFicv <- rbind(age_age.pds_LA.m_RVFicv,age_age.pds_BLDI.m_RVFicv,age_age.pds_BLVPL.m_RVFicv,age_age.pds_BM.m_RVFicv,age_age.pds_CMN.m_RVFicv,age_age.pds_CEN.m_RVFicv,age_age.pds_AAA.m_RVFicv,age_age.pds_ATA.m_RVFicv,age_age.pds_ASTA.m_RVFicv)
#write anova df to file
#write.csv(age_age.pds_anova.m_RVFicv, "RVFicv Male - Anova's for age vs age-by-pds_1.6.20.csv")
###s(pds) vs. ti(age, by:pds) only
pds_age.pds_LA.m_RVFicv <- anova(gamm_pds.m_RVFicv[["LA"]]$lme, gamm_age_pds.m_ti_RVFicv[["LA"]]$lme)
pds_age.pds_BLDI.m_RVFicv <- anova(gamm_pds.m_RVFicv[["BLDI"]]$lme, gamm_age_pds.m_ti_RVFicv[["BLDI"]]$lme)
pds_age.pds_BLVPL.m_RVFicv <- anova(gamm_pds.m_RVFicv[["BLVPL"]]$lme, gamm_age_pds.m_ti_RVFicv[["BLVPL"]]$lme)
pds_age.pds_BM.m_RVFicv <- anova(gamm_pds.m_RVFicv[["BM"]]$lme, gamm_age_pds.m_ti_RVFicv[["BM"]]$lme)
pds_age.pds_CMN.m_RVFicv <- anova(gamm_pds.m_RVFicv[["CMN"]]$lme, gamm_age_pds.m_ti_RVFicv[["CMN"]]$lme)
pds_age.pds_CEN.m_RVFicv <- anova(gamm_pds.m_RVFicv[["CEN"]]$lme, gamm_age_pds.m_ti_RVFicv[["CEN"]]$lme)
pds_age.pds_AAA.m_RVFicv <- anova(gamm_pds.m_RVFicv[["AAA"]]$lme, gamm_age_pds.m_ti_RVFicv[["AAA"]]$lme)
pds_age.pds_ATA.m_RVFicv <- anova(gamm_pds.m_RVFicv[["ATA"]]$lme, gamm_age_pds.m_ti_RVFicv[["ATA"]]$lme)
pds_age.pds_ASTA.m_RVFicv <- anova(gamm_pds.m_RVFicv[["ASTA"]]$lme, gamm_age_pds.m_ti_RVFicv[["ASTA"]]$lme)
#bind all anova's above to export
pds_age.pds_anova.m_RVFicv <- rbind(pds_age.pds_LA.m_RVFicv,pds_age.pds_BLDI.m_RVFicv,pds_age.pds_BLVPL.m_RVFicv,pds_age.pds_BM.m_RVFicv,pds_age.pds_CMN.m_RVFicv,pds_age.pds_CEN.m_RVFicv,pds_age.pds_AAA.m_RVFicv,pds_age.pds_ATA.m_RVFicv,pds_age.pds_ASTA.m_RVFicv)
#write anova df to file
#write.csv(pds_age.pds_anova.m_RVFicv, "RVFicv Male - Anova's for pds vs age-by-pds_1.6.20.csv")

##ABS
###s(age) vs. ti(age, by:pds)
age_age.pds_Total.m_ABS <- anova(gamm_age.m_ABS[["Abs_Total"]]$lme, gamm_age_pds.m_ti_ABS[["Abs_Total"]]$lme)
age_age.pds_LA.m_ABS <- anova(gamm_age.m_ABS[["Abs_LA"]]$lme, gamm_age_pds.m_ti_ABS[["Abs_LA"]]$lme)
age_age.pds_BLDI.m_ABS <- anova(gamm_age.m_ABS[["Abs_BLDI"]]$lme, gamm_age_pds.m_ti_ABS[["Abs_BLDI"]]$lme)
age_age.pds_BLVPL.m_ABS <- anova(gamm_age.m_ABS[["Abs_BLVPL"]]$lme, gamm_age_pds.m_ti_ABS[["Abs_BLVPL"]]$lme)
age_age.pds_BM.m_ABS <- anova(gamm_age.m_ABS[["Abs_BM"]]$lme, gamm_age_pds.m_ti_ABS[["Abs_BM"]]$lme)
age_age.pds_CMN.m_ABS <- anova(gamm_age.m_ABS[["Abs_CMN"]]$lme, gamm_age_pds.m_ti_ABS[["Abs_CMN"]]$lme)
age_age.pds_CEN.m_ABS <- anova(gamm_age.m_ABS[["Abs_CEN"]]$lme, gamm_age_pds.m_ti_ABS[["Abs_CEN"]]$lme)
age_age.pds_AAA.m_ABS <- anova(gamm_age.m_ABS[["Abs_AAA"]]$lme, gamm_age_pds.m_ti_ABS[["Abs_AAA"]]$lme)
age_age.pds_ATA.m_ABS <- anova(gamm_age.m_ABS[["Abs_ATA"]]$lme, gamm_age_pds.m_ti_ABS[["Abs_ATA"]]$lme)
age_age.pds_ASTA.m_ABS <- anova(gamm_age.m_ABS[["Abs_ASTA"]]$lme, gamm_age_pds.m_ti_ABS[["Abs_ASTA"]]$lme)
#bind all anova's above to export
age_age.pds_anova.m_ABS <- rbind(age_age.pds_Total.m_ABS,age_age.pds_LA.m_ABS,age_age.pds_BLDI.m_ABS,age_age.pds_BLVPL.m_ABS,age_age.pds_BM.m_ABS,age_age.pds_CMN.m_ABS,age_age.pds_CEN.m_ABS,age_age.pds_AAA.m_ABS,age_age.pds_ATA.m_ABS,age_age.pds_ASTA.m_ABS)
#write anova df to file
#write.csv(age_age.pds_anova.m_ABS, "ABS Male - Anova's for age vs age-by-pds_1.6.20.csv")
###s(pds) vs. ti(age, by:pds) only
pds_age.pds_Total.m_ABS <- anova(gamm_pds.m_ABS[["Abs_Total"]]$lme, gamm_age_pds.m_ti_ABS[["Abs_Total"]]$lme)
pds_age.pds_LA.m_ABS <- anova(gamm_pds.m_ABS[["Abs_LA"]]$lme, gamm_age_pds.m_ti_ABS[["Abs_LA"]]$lme)
pds_age.pds_BLDI.m_ABS <- anova(gamm_pds.m_ABS[["Abs_BLDI"]]$lme, gamm_age_pds.m_ti_ABS[["Abs_BLDI"]]$lme)
pds_age.pds_BLVPL.m_ABS <- anova(gamm_pds.m_ABS[["Abs_BLVPL"]]$lme, gamm_age_pds.m_ti_ABS[["Abs_BLVPL"]]$lme)
pds_age.pds_BM.m_ABS <- anova(gamm_pds.m_ABS[["Abs_BM"]]$lme, gamm_age_pds.m_ti_ABS[["Abs_BM"]]$lme)
pds_age.pds_CMN.m_ABS <- anova(gamm_pds.m_ABS[["Abs_CMN"]]$lme, gamm_age_pds.m_ti_ABS[["Abs_CMN"]]$lme)
pds_age.pds_CEN.m_ABS <- anova(gamm_pds.m_ABS[["Abs_CEN"]]$lme, gamm_age_pds.m_ti_ABS[["Abs_CEN"]]$lme)
pds_age.pds_AAA.m_ABS <- anova(gamm_pds.m_ABS[["Abs_AAA"]]$lme, gamm_age_pds.m_ti_ABS[["Abs_AAA"]]$lme)
pds_age.pds_ATA.m_ABS <- anova(gamm_pds.m_ABS[["Abs_ATA"]]$lme, gamm_age_pds.m_ti_ABS[["Abs_ATA"]]$lme)
pds_age.pds_ASTA.m_ABS <- anova(gamm_pds.m_ABS[["Abs_ASTA"]]$lme, gamm_age_pds.m_ti_ABS[["Abs_ASTA"]]$lme)
#bind all anova's above to export
pds_age.pds_anova.m_ABS <- rbind(pds_age.pds_Total.m_ABS,pds_age.pds_LA.m_ABS,pds_age.pds_BLDI.m_ABS,pds_age.pds_BLVPL.m_ABS,pds_age.pds_BM.m_ABS,pds_age.pds_CMN.m_ABS,pds_age.pds_CEN.m_ABS,pds_age.pds_AAA.m_ABS,pds_age.pds_ATA.m_ABS,pds_age.pds_ASTA.m_ABS)
#write anova df to file
#write.csv(pds_age.pds_anova.m_ABS, "ABS Male - Anova's for pds vs age-by-pds_1.6.20.csv")

```




Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

